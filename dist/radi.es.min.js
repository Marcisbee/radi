var GLOBALS={VERSION:'0.5.0',CUSTOM_ATTRIBUTES:{},CUSTOM_TAGS:{},SERVICES:{}};function service(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];if(typeof n!=='string'){throw new Error('[Radi.js] Service first argument has to be string')}if(typeof e!=='function'){throw new Error('[Radi.js] Service second argument has to be function')}var i=e.apply(void 0,t);service.prototype[n]=i;return GLOBALS.SERVICES[n]=i}function customAttribute(n,e,t){t===void 0&&(t={});var r=t.allowedTags,i=t.addToElement;return GLOBALS.CUSTOM_ATTRIBUTES[n]={name:n,caller:e,allowedTags:r||null,addToElement:i}}function customTag(n,e){return GLOBALS.CUSTOM_TAGS[n]={name:n,render:e||(function(){})}}function fireEvent(n,e){var t=document.createEvent('Event');t.initEvent(n,!0,!0);typeof e.dispatchEvent==='function'&&(e._eventFired=!0,e.dispatchEvent(t));return e}function destroyTree(n){fireEvent('destroy',n);var e=n.__radiInstance;e&&(e.trigger('destroy'),e.__onDestroy());n.__radiInstance=null;if(n.nodeType===1){var t=n.firstChild;while(t)destroyTree(t),t=t.nextSibling}}function capitalise(n){return n.charAt(0).toUpperCase()+n.substr(1)}function flatten(n){return n.reduce(function(n,e){return n.concat(Array.isArray(e)?flatten(e):e)},[])}var isValidElement=function(n){return n.name&&(n.value||n.value==='')},isValidValue=function(n){return!['checkbox','radio'].includes(n.type)||n.checked},isCheckbox=function(n){return n.type==='checkbox'},isMultiSelect=function(n){return n.options&&n.multiple},getSelectValues=function(n){return[].reduce.call(n,function(n,e){return e.selected?n.concat(e.value):n},[])},formToJSON=function(n,e){e===void 0&&(e=function(n,e){return e});return[].reduce.call(n,function(n,t){isValidElement(t)&&isValidValue(t)&&(isCheckbox(t)?(n[t.name]=(n[t.name]||[]).concat(e(t,t.value))):isMultiSelect(t)?(n[t.name]=e(t,getSelectValues(t))):(n[t.name]=e(t,t.value)));return n},{})};function html(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];var i=typeof n==='number'?""+n:n,u=e||{},o=flatten(t);(i instanceof Promise||i&&i.constructor.name==='LazyPromise')&&(i='await',u={src:n});typeof GLOBALS.CUSTOM_TAGS[i]!=='undefined'&&(i=GLOBALS.CUSTOM_TAGS[i].render);return{type:i,props:u,children:o}}var Component=function(n,e){this.self=n;this.name=e||n.name;this.__$events={}};Component.prototype.on=function(n,e){var t=this.__$events,r="on"+(capitalise(n));t[r]||(t[r]=[]);t[r].push(e);return e};Component.prototype.trigger=function(n){var e,t,r=[],i=arguments.length-1;while(i-->0)r[i]=arguments[i+1];var u="on"+(capitalise(n));(this.__$events[u]||[]).map(function(n){return n.apply(void 0,r)});typeof this[u]==='function'&&(e=this)[u].apply(e,r);typeof this.self[u]==='function'&&(t=this.self)[u].apply(t,r)};var componentStore={currentComponent:null};function setAttribute(n,e,t){if(typeof GLOBALS.CUSTOM_ATTRIBUTES[e]!=='undefined'){var r=GLOBALS.CUSTOM_ATTRIBUTES[e],i=r.allowedTags;if(!i||i&&i.length>0&&i.indexOf(n.localName)>=0){typeof GLOBALS.CUSTOM_ATTRIBUTES[e].caller==='function'&&GLOBALS.CUSTOM_ATTRIBUTES[e].caller(n,t);if(!GLOBALS.CUSTOM_ATTRIBUTES[e].addToElement){return}}}if(typeof t==='function'&&e.startsWith('on')){var u=e.slice(2).toLowerCase();n.__radiHandlers=n.__radiHandlers||{};n.removeEventListener(u,n.__radiHandlers[u]);n.__radiHandlers[u]=t;n.addEventListener(u,n.__radiHandlers[u])}else e==='checked'||e==='value'||e==='className'?(n[e]=t):e==='style'&&typeof t==='object'?Object.assign(n.style,t):e==='ref'&&typeof t==='function'?t(n):e==='key'?(n.__radiKey=t):typeof t!=='object'&&typeof t!=='function'&&(t?n.setAttribute(e,t):n.removeAttribute(e))}function render(n,e){var t;e===void 0&&(e=null);var r=e?(function(n){return e.appendChild(n)}):(function(n){return n}),i;if(typeof n==='string'||typeof n==='number')i=r(document.createTextNode(n));else if(typeof n==='boolean'||n===null||typeof n==='undefined')i=r(document.createTextNode(''));else if(typeof n==='object'&&typeof n.type==='function')i=renderComponent(n,e);else if(typeof n==='object'&&typeof n.type==='string'){var u=r(document.createElement(n.type));for(var o of (t=[]).concat.apply(t,n.children))render(o,u);for(var c in n.props)setAttribute(u,c,n.props[c]);i=u}if(i){fireEvent('mount',i);return i}throw new Error(("Invalid VDOM: "+n+"."))}function evaluate(n,e){var t=componentStore.currentComponent;componentStore.currentComponent=n;var r=e();componentStore.currentComponent=t;return r}function renderComponent(n,e){var t=Object.assign({},n.props,{children:n.children}),r=new Component(n.type);r.update=function(){return patchComponent(r.dom,n,e)};r.render=function(e){e===void 0&&(e=r);return(evaluate(e,function(){return n.type.call(r,t)}))};r.dom=render(r.render(),e);var i;r.dom&&typeof r.dom.addEventListener==='function'&&(r.on('mount',function(){typeof r.style==='string'&&(i=document.createElement('style'),i.innerHTML=r.style,document.head.appendChild(i))},{passive:!0,once:!0},!1),r.on('destroy',function(){i instanceof Node&&document.head.removeChild(i)},{passive:!0,once:!0},!1));r.dom.__radiInstance=r;r.trigger('mount',r.dom,e);return r.dom}function patchComponent(n,e,t){t===void 0&&(t=n.parentNode);var r=Object.assign({},e.props,{children:e.children}),i=n.__radiInstance;if(i&&i.self===e.type){return patch(n,i.render(),t)}else if(i.isPrototypeOf(e.type)){var u=renderComponent(e,t);return t?t.replaceChild(u,n)&&u:u}else if(!i.isPrototypeOf(e.type)){return patch(n,e.type(r),t)}return null}function beforeDestroy(n,e){if(typeof n.beforedestroy==='function'){return n.beforedestroy(e)}return e()}function patch(n,e,t){var r,i;t===void 0&&(t=n.parentNode);var u=t?function(e){return t.replaceChild(e,n)&&e}:(function(n){return n});if(typeof e==='object'&&typeof e.type==='function'){return patchComponent(n,e,t)}else if(typeof e!=='object'&&n instanceof Text){return n.textContent!==e?u(render(e,t)):n}else if(typeof e==='object'&&n instanceof Text){return u(render(e,t))}else if(typeof e==='object'&&n.nodeName!==e.type.toUpperCase()){return u(render(e,t))}else if(typeof e==='object'&&n.nodeName===e.type.toUpperCase()){var o={},c=document.activeElement;(r=[]).concat.apply(r,n.childNodes).filter(function(n){return!n.__radiRemoved}).forEach(function(n,e){var t=n.__radiKey||"__index_"+e;o[t]=n});(i=[]).concat.apply(i,e.children).forEach(function(e,t){var r=e.props&&(e.props.key||"__index_"+t);if(o[r])fireEvent('update',patch(o[r],e)),delete o[r];else{var i=o[r]?patch(o[r],e):render(e,n);i&&(n.appendChild(i),delete o[r])}});var a=function(n){o[n].__radiRemoved=!0;beforeDestroy(o[n],function(){destroyTree(o[n]);o[n].remove()})};for(var s in o)a(s);for(var l of n.attributes)n.removeAttribute(l.name);for(var d in e.props)setAttribute(n,d,e.props[d]);c.focus();return n}return null}function anchored(n,e){return function(t,r){if(n[0]===t){return!1}t!==r&&(n[0]=t,e.dispatch(function(){return t}));return!0}}function extractState(n,e){var t=this;e===void 0&&(e=[]);if(!n){return n}if(this&&n&&typeof n.subscribe==='function'){var r=[];e.length>0?n.subscribe(function(n,i){if(r[0]===n){return!1}n!==i&&(t.dispatch(function(){return t.setPartial(e,n)}),r[0]=n);return!0}):(this.subscribe(anchored(r,n)),n.subscribe(anchored(r,this)));return n.get()}if(typeof n==='object'){var i=Array.isArray(n)?new Array(n.length):{};for(var u in n)n.hasOwnProperty(u)&&(i[u]=extractState.call(t,n[u],e.concat(u)));return i}return n}function clone(n,e){var t=Array.isArray(n)?[]:{};for(var r in n)t[r]=n[r];for(var i in e)t[i]=e[i];return t}function proxied(n,e,t){t===void 0&&(t=[]);return new Proxy(n,{get:function(r,i){var u=t.concat(i);if(typeof n[i]==='object'){return proxied(n[i],e,u)}typeof e==='function'&&e(u);return n[i]}})}function Dependencies(){var n=this;this.dependencies={};this.add=function(e,t){var r=e[0];typeof n.dependencies[r]==='undefined'&&(n.dependencies[r]=[]);n.dependencies[r].indexOf(t)<0&&n.dependencies[r].push(t)};this.remove=function(e,t){var r=e[0],i=(n.dependencies[r]||[]).indexOf(t);i>=0&&n.dependencies[r].splice(i,1)};this.fn=function(e){return function(t){var r=componentStore.currentComponent;r&&(n.add(t,r),r.on('destroy',function(){n.remove(t,r)}));return e(t)}};this.trigger=function(e,t,r){n.dependencies[e]&&n.dependencies[e].forEach(function(n){return((n.update?n.update:n)(t,r))})}}function Store(n,e){var t=this;n===void 0&&(n={});e===void 0&&(e=function(){});var r=Object.assign({},n),i=function(){return proxied(i.get(),u.fn(e))},u=new Dependencies,o=function(n){return n};i.getInitial=function(){return c};i.get=function(){return o(r)};i.setPartial=function(n,e){var i=Array.isArray(r)?[]:{};if(n.length){i[n[0]]=n.length>1?t.setPartial(n.slice(1),e,r[n[0]]):e;return clone(r,i)}return e};i.update=function(n){var e=Object.keys(n),t=r,o=Object.assign({},r,n);r=o;u.trigger('*',i.get(),t);e.forEach(function(n){return u.trigger(n,i.get(),t)});return r};i.dispatch=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];var u=n.apply(void 0,[r].concat(e));return i.update(u)};i.willDispatch=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return function(){var t=[],r=arguments.length;while(r--)t[r]=arguments[r];return i.dispatch.apply(i,[n].concat(e,t))}};i.subscribe=function(n){u.add('*',n);n(i.get(),null);return i};i.unsubscribe=function(n){u.remove('*',n)};i.map=function(n){var e=o;o=function(){var t=[],r=arguments.length;while(r--)t[r]=arguments[r];return n(e.apply(void 0,t))};return i};var c=extractState.call(i,n);return i}function Subscribe(n){n===void 0&&(n=document);return{on:function(e,t){t===void 0&&(t=function(n){return n});var r=e.trim().split(' '),i=null,u=null,o=null,c=!1;if(typeof t!=='function'){throw new Error(("[Radi.js] Subscription `"+e+"` must be transformed by function"))}function a(e,a){var s=a||new Store(e||{});c=!0;u=e;o=s;r.map(function(e){return n.addEventListener(e,i=function(){var n=[],r=arguments.length;while(r--)n[r]=arguments[r];return s.dispatch(function(r){return(Object.assign({},r,t.apply(void 0,n.concat([e]))))})})});return s}a.stop=function(){c&&r.map(function(e){return n.removeEventListener(e,i)});return c=!c};a.start=function(){return!c&&a(u,o)};return a}}}var animate=function(n,e,t,r){var i=t[e];if(typeof i!=='function'){console.warn(("[Radi.js] Animation `"+e+"` for node `"+n.nodeName.toLowerCase+"` should be function"));return}return i(n,r)};customAttribute('animation',function(n,e){animate(n,'in',e,function(){});n.beforedestroy=function(t){return animate(n,'out',e,t)}});customAttribute('html',function(n,e){var t=function(){n.escape?(n.textContent=e):(n.innerHTML=e)};n.addEventListener('mount',t);n.addEventListener('update',t)});customAttribute('loadfocus',function(n){n.addEventListener('mount',function(){return n.focus()})});customAttribute('onsubmit',function(n,e){return function(t){n.prevent&&t.preventDefault();e(t,formToJSON(n.elements||{}))}},{allowedTags:['form'],addToElement:!0});var errorsStore=new Store({},'errorStore'),setErrors=function(n,e,t){var r;return(Object.assign({},n,(r={}, r[e]=t, r)))};function fullValidate(n,e,t){var r=formToJSON(n,function(n,e){var t=n.touched;return({touched:t,value:e})}),i=Object.keys(r).reduce(function(n,e){var t;return(Object.assign({},n,(t={}, t[e]=r[e].value, t)))},{}),u=[];for(var o in r){var c=r[o];if(typeof e[o]==='function'){var a=e[o](c.value,i),s=a&&typeof a.check==='function'&&a.check()||a||o+' field is invalid';s!==!0&&u.push({field:o,touched:Boolean(c.touched),error:s})}}t(u)}var formCount=0;customAttribute('onvalidate',function(n,e){var t=n.name||'defaultForm'+formCount++,r;function i(n){errorsStore.dispatch(setErrors,t,n)}errorsStore.subscribe(function(n){r&&(r.disabled=n[t].length>0)});n.addEventListener('mount',function(n){var t=e(n),u=n.target.elements;if(t&&typeof t==='object'&&u){for(var o of u){var c=o.name;if(!o.__radiValidate&&typeof c==='string'&&typeof t[c]==='function'){o.addEventListener('input',function(){fullValidate(u,t,i)});o.__radiValidate=!0;o.touched=!1;var a=function(n){var e=n.target;e.touched=!0;e.removeEventListener('change',a);fullValidate(u,t,i)};o.addEventListener('change',a)}o.type==='submit'&&o.disabled===!0&&(r=o)}fullValidate(u,t,i)}},!1)},{allowedTags:['form']});var validValue=function(n){return typeof n==='string'||typeof n==='number'||n},Validator=function(n){this.value=n;this.rules=[]};Validator.prototype.register=function(n){var e=this,t=n.type,r=n.validate,i=n.error,u=this.rules.push({type:t,validate:function(n){return validValue(n)&&r(n)},error:i||'Invalid field'});this.error=function(n){e.rules[u-1].error=n||i;return e};return this};Validator.prototype.check=function(n){var e=this;typeof n!=='undefined'&&(this.value=n);return this.rules.reduce(function(n,t){return typeof n==='string'?n:!t.validate(e.value)&&t.error||n},!0)};Validator.prototype.required=function(){return this.register({type:'required',validate:function(n){return n!==''},error:'Field is required'})};Validator.prototype.test=function(n){return this.register({type:'test',validate:function(e){return e===''||n.test(e)},error:'Field must be valid'})};Validator.prototype.equal=function(n){return this.register({type:'equal',validate:function(e){return e===''||e===n},error:'Field must be equal to '+n})};Validator.prototype.notEqual=function(n){return this.register({type:'notEqual',validate:function(e){return e===''||e!==n},error:'Field must not be equal to '+n})};Validator.prototype.min=function(n){return this.register({type:'min',validate:function(e){return e.length>=n},error:'Min char length is '+n})};Validator.prototype.max=function(n){return this.register({type:'max',validate:function(e){return e.length<n},error:'Max char length is '+n})};Validator.prototype.email=function(){return this.register({type:'email',validate:function(n){return n===''||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)},error:'Email is not valid'})};var Radi={v:GLOBALS.VERSION,version:GLOBALS.VERSION,h:html,html:html,Store:Store,customTag:customTag,customAttribute:customAttribute,patch:patch,mount:render,service:service,Subscribe:Subscribe,Validator:Validator};Radi.plugin=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return n.apply(void 0,[Radi].concat(e))};window&&(window.Radi=Radi);export default Radi