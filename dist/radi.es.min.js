var GLOBALS={VERSION:'0.5.0',CUSTOM_ATTRIBUTES:{},CUSTOM_TAGS:{},SERVICES:{}};function service(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];if(typeof n!=='string'){throw new Error('[Radi.js] Service first argument has to be string')}if(typeof e!=='function'){throw new Error('[Radi.js] Service second argument has to be function')}var u=e.apply(void 0,t);service.prototype[n]=u;return GLOBALS.SERVICES[n]=u}function capitalise(n){return n.charAt(0).toUpperCase()+n.substr(1)}function ensureArray(n){if(arguments.length===0){return[]}if(arguments.length===1){if(n===void 0||n===null){return[]}if(Array.isArray(n)){return n}}return Array.prototype.slice.call(arguments)}function flatten(n){return n.reduce(function(n,e){return n.concat(Array.isArray(e)?flatten(e):e)},[])}var isValidElement=function(n){return n.name&&(n.value||n.value==='')},isValidValue=function(n){return!['checkbox','radio'].includes(n.type)||n.checked},isCheckbox=function(n){return n.type==='checkbox'},isMultiSelect=function(n){return n.options&&n.multiple},getSelectValues=function(n){return[].reduce.call(n,function(n,e){return e.selected?n.concat(e.value):n},[])},formToJSON=function(n,e){e===void 0&&(e=function(n,e){return e});return[].reduce.call(n,function(n,t){isValidElement(t)&&isValidValue(t)&&(isCheckbox(t)?(n[t.name]=(n[t.name]||[]).concat(e(t,t.value))):isMultiSelect(t)?(n[t.name]=e(t,getSelectValues(t))):(n[t.name]=e(t,t.value)));return n},{})},Component=function(n,e){this.self=n;this.name=e||n.name;this.__$events={}};Component.prototype.on=function(n,e){var t=this.__$events,r="on"+(capitalise(n));t[r]||(t[r]=[]);t[r].push(e);return e};Component.prototype.trigger=function(n){var e,t,r=[],u=arguments.length-1;while(u-->0)r[u]=arguments[u+1];var i="on"+(capitalise(n));(this.__$events[i]||[]).map(function(n){return n.apply(void 0,r)});typeof this[i]==='function'&&(e=this)[i].apply(e,r);typeof this.self[i]==='function'&&(t=this.self)[i].apply(t,r)};function destroyTree$$1(n){fireEvent('destroy',n);if(n.nodeType===1){var e=n.firstChild;while(e)destroyTree$$1(e),e=e.nextSibling}}function fireEvent(n,e){var t=document.createEvent('Event');t.initEvent(n,!0,!0);typeof e.dispatchEvent==='function'&&(e._eventFired=!0,e.dispatchEvent(t));return e}function insertAfter(n,e,t){t||(t=e.parentNode);if(n instanceof Node){if(e===null||e===void 0){return t.insertBefore(n,e)}if(e instanceof Node){return t.insertBefore(n,e.nextSibling)}}return n}function nodeChanged(n,e){if(n===void 0||e===void 0){return!1}if(typeof n!==typeof e){return!0}if((typeof n==='string'||typeof n==='number')&&n!==e){return!0}if(n.type!==e.type){return!0}if(n.props){return!0}return!1}function autoUpdate(n,e){if(n instanceof Listener){return e(n.getValue(function(t){return e(n.map(t))}))}return e(n)}function setBooleanProp(n,e,t){t?(n.setAttribute(e,t),n[e]=!0):(n[e]=!1)}function removeBooleanProp(n,e){n.removeAttribute(e);n[e]=!1}function isEventProp(n){return /^on/.test(n)}function extractEventName(n){return n.slice(2).toLowerCase()}function isCustomProp(n){return isEventProp(n)}function setProp(n,e,t){if(typeof GLOBALS.CUSTOM_ATTRIBUTES[e]!=='undefined'){var r=GLOBALS.CUSTOM_ATTRIBUTES[e],u=r.allowedTags,i=r.addToElement,o=r.caller;if(!u||u&&u.length>0&&u.indexOf(n.localName)>=0){typeof o==='function'&&(t=o(n,t));if(!i){return}}}e==='style'?setStyles(n,t):isCustomProp(e)?addEventListener(n,e,t):e==='className'?n.setAttribute('class',t):typeof t==='boolean'?setBooleanProp(n,e,t):(e==='value'&&document.activeElement!==n&&(n[e]=t),n.setAttribute(e,t))}function removeProp(n,e,t){isCustomProp(e)||(e==='className'?n.removeAttribute('class'):typeof t==='boolean'?removeBooleanProp(n,e):n.removeAttribute(e))}function setStyles(n,e){Object.keys(e).forEach(function(t){autoUpdate(e[t],function(e){n.style[t]=e})})}function setProps(n,e){Object.keys(e).forEach(function(t){autoUpdate(e[t],function(e){t==='model'?(t='value'):(t==='class'||t==='className')&&(Array.isArray(e)&&(e=e.filter(function(n){return n&&typeof n!=='function'}).join(' ')));setProp(n,t,e)})})}function updateProp(n,e,t,r){t?(!r||t!==r)&&setProp(n,e,t):removeProp(n,e,r)}function updateProps(n,e,t){t===void 0&&(t={});var r=Object.assign({},e,t);Object.keys(r).forEach(function(r){autoUpdate(e[r],function(e){r==='model'&&(r='value');updateProp(n,r,e,t[r])})})}function addEventListener(n,e,t){var r=['mount','destroy'];isEventProp(e)&&n.addEventListener(extractEventName(e),function(u){r.indexOf(e)>=0?(n===u.target&&t(u)):typeof t==='function'&&t(u)},!1)}function beforeDestroy(n,e){if(typeof n.beforedestroy==='function'){return n.beforedestroy(e)}return e()}function patch(n,e,t,r,u){r===void 0&&(r=0);var i=n&&n.childNodes[r];u&&(r=Array.prototype.indexOf.call(n.childNodes,u)+1);var o=flatten(ensureArray(e)),c=flatten(ensureArray(t)),l=o.length,a=c.length,d=0,f=function(e){o[e] instanceof Date&&(o[e]=o[e].toString());if(c[e]===!1||c[e]===void 0||c[e]===null)i=createElement$$1(o[e],n),u?insertAfter(i,n.childNodes[(r+e-1)],n):n.appendChild(i),fireEvent('mount',i);else if(o[e]===!1||o[e]===void 0||o[e]===null){var t=n.childNodes[r+e+d];t&&beforeDestroy(t,function(){var t=n.childNodes[r+e+d];n.removeChild(t);destroyTree$$1(t);d-=1})}else if(nodeChanged(o[e],c[e]))n.replaceChild(i=createElement$$1(o[e],n),n.childNodes[r+e]),fireEvent('mount',i);else if(typeof o[e].type==='string'){var l=o[e],a=c[e];updateProps(n.childNodes[r+e],l.props,a.props);var f=l.children.length,s=a.children.length;for(var p=0;p<f||p<s;p++)patch(n.childNodes[r+e],l.children[p],a.children[p],p)}};for(var s=0;s<l||s<a;s++)f(s);return o}var currentListener=null;function anchored(n,e){return function(t,r){if(n[0]===t){return!1}t!==r&&(n[0]=t,e.dispatch(function(){return t}));return!0}}function extractState(n,e){var t=this;e===void 0&&(e=[]);if(!n){return n}if(this&&n&&typeof n.subscribe==='function'){var r=[];e.length>0?n.subscribe(function(n,u){if(r[0]===n){return!1}n!==u&&(t.dispatch(function(){return t.setPartial(e,n)}),r[0]=n);return!0}):(this.subscribe(anchored(r,n)),n.subscribe(anchored(r,this)));return n.get()}if(typeof n==='object'){var u=Array.isArray(n)?new Array(n.length):{};for(var i in n)n.hasOwnProperty(i)&&(u[i]=extractState.call(t,n[i],e.concat(i)));return u}return n}function clone(n,e){var t=Array.isArray(n)?[]:{};for(var r in n)t[r]=n[r];for(var u in e)t[u]=e[u];return t}function proxied(n,e,t){t===void 0&&(t=[]);return new Proxy(n,{get:function(r,u){var i=t.concat(u);if(typeof n[u]==='object'){return proxied(n[u],e,i)}typeof e==='function'&&e(i);return n[u]}})}var renderQueue=[];function addToRenderQueue(n){var e=n.update||n;renderQueue.indexOf(e)<0&&renderQueue.push(e);return e}function clearRenderQueue(){renderQueue=[]}function Dependencies(){var n=this;this.dependencies={};this.add=function(e,t){var r=e[0];typeof n.dependencies[r]==='undefined'&&(n.dependencies[r]=[]);n.dependencies[r].indexOf(t)<0&&n.dependencies[r].push(t)};this.remove=function(e,t){var r=e[0],u=(n.dependencies[r]||[]).indexOf(t);u>=0&&n.dependencies[r].splice(u,1)};this.fn=function(e){return function(t){var r=currentListener;r&&(n.add(t,r),r.__onDestroy=function(){n.remove(t,r)});return e(t)}};this.trigger=function(e,t,r){n.dependencies[e]&&n.dependencies[e].forEach(function(n){return(addToRenderQueue(n)(t,r))})}}var noop=function(n){return n},Listener=function(n,e,t){this.map=n;this.update=this.update.bind(this);this.render=this.render.bind(this);this.store=e;this.dep=t};Listener.prototype.getValue=function(n){var e=currentListener;currentListener=n;var t=proxied(this.store.get(),this.dep.fn(function(){}));this.newTree=this.map(t);currentListener=e;return this.newTree};Listener.prototype.update=function(){var n=this.getValue(this.update);patch(this.$parent,this.newTree,this.oldTree,0,this.$pointer);this.oldTree=this.newTree;return n};Listener.prototype.render=function(n){var e=this;return function(){this.onMount=function(t,r){e.mounted=!0;e.$pointer=t;e.$parent=r||t.parentNode;e.update(n)};return null}};function getDataFromObject(n,e){var t=0;while(t<n.length)typeof e==='undefined'?t++:(e=e[n[t++]]);return e}function updateState(n,e,t,r,u,i){i===void 0&&(i='');var o=n.setPartial(t,r);if(!u){var c=function(){return o};Object.defineProperty(c,'name',{value:i,writable:!1});n.dispatch(c)}else n.update(o)}function Store(n){var e=this;n===void 0&&(n={});var t=Object.assign({},n),r=function(n){var e=new Listener(n,r,u);return e},u=new Dependencies,i=noop,o;r.getInitial=function(){return c};r.get=function(n){var e=i(t);if(n){return getDeep(typeof n==='string'?n.split('.'):n,e)}return e};r.setPartial=function(n,r){var u=Array.isArray(t)?[]:{};if(n.length){u[n[0]]=n.length>1?e.setPartial(n.slice(1),r,t[n[0]]):r;return clone(t,u)}return r};r.bind=function(n,e,t){e===void 0&&(e=function(n){return n});t===void 0&&(t=function(n){return n});var u=Array.isArray(n)?n:n.split('.'),i=function(n){return e(getDataFromObject(u,n))},o=function(e){return updateState(r,r.get(),u,t(e),!1,("Bind:"+n))};return{model:r(i),oninput:function(n){return o(n.target.value)}}};r.update=function(n){var e=Object.keys(n),c=Object.assign({},t,n);t=c;var l=r.get();if(i!==noop){for(var a in l)l.hasOwnProperty(a)&&(!o||o&&o[a]!==l[a]&&e.indexOf(a)<0)&&e.push(a)}u.trigger('*',l,o);e.forEach(function(n){return u.trigger(n,l,o)});o=l;clearRenderQueue();return t};r.dispatch=function(n){var e=[],u=arguments.length-1;while(u-->0)e[u]=arguments[u+1];var i=n.apply(void 0,[t].concat(e));return r.update(i)};r.willDispatch=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return function(){var t=[],u=arguments.length;while(u--)t[u]=arguments[u];return r.dispatch.apply(r,[n].concat(e,t))}};r.subscribe=function(n){u.add('*',n);n(r.get(),null);return r};r.unsubscribe=function(n){u.remove('*',n)};r.map=function(n){var e=i;i=function(){var t=[],r=arguments.length;while(r--)t[r]=arguments[r];return n(e.apply(void 0,t))};return r};var c=extractState.call(r,n);return r}function mount(n,e){return{component:n,node:patch(e,n),destroy:function(){return patch(e,null,n)}}}function createElement$$1(n,e){if(typeof n==='string'||typeof n==='number'){return document.createTextNode(n)}if(n===void 0||n===!1||n===null){return document.createComment('')}n instanceof Listener&&(n=n.render());if(Array.isArray(n)){var t=document.createTextNode('');t.addEventListener('mount',function(){for(var t=0;t<n.length;t++)mount(n[t],e)});return t}if(typeof n==='function'||typeof n.type==='function'){var r=n.type||n,u=new Component(r),i=createElement$$1(r.call(u,Object.assign({},(n.props||{}),{children:n.children||[]})),e),o;i&&typeof i.addEventListener==='function'&&(i.addEventListener('mount',function(){typeof u.style==='string'&&(o=document.createElement('style'),o.innerHTML=u.style,document.head.appendChild(o));u.trigger('mount',i,e)},{passive:!0,once:!0},!1),i.addEventListener('destroy',function(){u.trigger('destroy',i,e);o instanceof Node&&document.head.removeChild(o)},{passive:!0,once:!0},!1));return i}if(typeof n==='object'){if(n.type){var c;n.type==='svg'||e instanceof SVGElement?(c=document.createElementNS('http://www.w3.org/2000/svg',n.type)):(c=document.createElement(n.type));var l=null;setProps(c,n.props);var a=function(n){return function(e){var t=createElement$$1(e,n);t&&(l?insertAfter(t,l,n):(n.appendChild.call(c,t),fireEvent('mount',t)))}};n.children.map(a(c));return c}return createElement$$1(JSON.stringify(n),e)}return document.createTextNode((""+n))}function customAttribute(n,e,t){t===void 0&&(t={});var r=t.allowedTags,u=t.addToElement;return GLOBALS.CUSTOM_ATTRIBUTES[n]={name:n,caller:e,allowedTags:r||null,addToElement:u}}function customTag(n,e){return GLOBALS.CUSTOM_TAGS[n]={name:n,render:e||(function(){})}}function html(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];var u=typeof n==='number'?""+n:n,i=e||{},o=flatten(t);(u instanceof Promise||u&&u.constructor.name==='LazyPromise')&&(u='await',i={src:n});typeof GLOBALS.CUSTOM_TAGS[u]!=='undefined'&&(u=GLOBALS.CUSTOM_TAGS[u].render);return{type:u,props:i,children:o}}function Subscribe(n){n===void 0&&(n=document);return{on:function(e,t){t===void 0&&(t=function(n){return n});var r=e.trim().split(' '),u=null,i=null,o=null,c=!1;if(typeof t!=='function'){throw new Error(("[Radi.js] Subscription `"+e+"` must be transformed by function"))}function l(e,l){var a=l||new Store(e||{});c=!0;i=e;o=a;r.forEach(function(e){return n.addEventListener(e,u=function(){var n=[],r=arguments.length;while(r--)n[r]=arguments[r];return a.dispatch(function(r){return(Object.assign({},r,t.apply(void 0,n.concat([e]))))})})});return a}l.stop=function(){c&&r.forEach(function(e){return n.removeEventListener(e,u)});return c=!c};l.start=function(){return!c&&l(i,o)};return l}}}var animate=function(n,e,t,r){var u=t[e];if(typeof u!=='function'){console.warn(("[Radi.js] Animation `"+e+"` for node `"+n.nodeName.toLowerCase+"` should be function"));return}return u(n,r)};customAttribute('animation',function(n,e){animate(n,'in',e,function(){});n.beforedestroy=function(t){return animate(n,'out',e,t)}});customAttribute('html',function(n,e){n.addEventListener('mount',function(){n.escape?(n.textContent=e):(n.innerHTML=e)})});customAttribute('loadfocus',function(n){n.addEventListener('mount',function(){return n.focus()})});customAttribute('onsubmit',function(n,e){return function(t){n.prevent&&t.preventDefault();e(t,formToJSON(n.elements||{}))}},{allowedTags:['form'],addToElement:!0});var errorsStore=new Store({},'errorStore'),setErrors=function(n,e,t){var r;return(Object.assign({},n,(r={}, r[e]=t, r)))};function fullValidate(n,e,t){var r=formToJSON(n,function(n,e){var t=n.touched;return({touched:t,value:e})}),u=Object.keys(r).reduce(function(n,e){var t;return(Object.assign({},n,(t={}, t[e]=r[e].value, t)))},{}),i=[];for(var o in r){var c=r[o];if(typeof e[o]==='function'){var l=e[o](c.value,u),a=l&&typeof l.check==='function'&&l.check()||l||o+' field is invalid';a!==!0&&i.push({field:o,touched:Boolean(c.touched),error:a})}}t(i)}var formCount=0;customAttribute('onvalidate',function(n,e){var t=n.name||'defaultForm'+formCount++,r;function u(n){errorsStore.dispatch(setErrors,t,n)}errorsStore.subscribe(function(n){r&&(r.disabled=n[t].length>0)});n.addEventListener('mount',function(n){var t=e(n),i=n.target.elements;if(t&&typeof t==='object'&&i){for(var o of i){var c=o.name;if(!o.__radiValidate&&typeof c==='string'&&typeof t[c]==='function'){o.addEventListener('input',function(){fullValidate(i,t,u)});o.__radiValidate=!0;o.touched=!1;var l=function(n){var e=n.target;e.touched=!0;e.removeEventListener('change',l);fullValidate(i,t,u)};o.addEventListener('change',l)}o.type==='submit'&&o.disabled===!0&&(r=o)}fullValidate(i,t,u)}},!1)},{allowedTags:['form']});function ensureFn(n){if(typeof n==='function'){return n}return function(e){return n||e}}customTag('await',function(n){var e=n.src,t=new Store({status:'placeholder'}),r=function(n,e){return({status:e})};if(e&&(e instanceof Promise||e.constructor.name==='LazyPromise')){var u='';e.then(function(n){u=n;t.dispatch(r,'transform')}).catch(function(n){u=n;t.dispatch(r,'error')});return t(function(e){var t=e.status;return ensureFn(n[t])(u)})}return null});customTag('errors',function(n){var e=n.name,t=n.onrender;typeof e==='undefined'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `name` attribute!');typeof t!=='function'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `onrender` attribute!');return errorsStore(function(n){return n[e]&&t(n[e])})});var h=html,ModalStore=new Store({}),registerModal=function(n,e){var t;return(t={}, t[e]=!1, t)},switchModal=function(n,e,t){var r;return(r={}, r[e]=t, r)},ModalService=service('modal',function(){var n=[],e=arguments.length;while(e--)n[e]=arguments[e];return{open:function(n){return ModalStore.dispatch(switchModal,n,!0)},close:function(n){return ModalStore.dispatch(switchModal,n,!1)},onOpen:function(n,e){return ModalStore.subscribe(function(t,r){return t[n]===!0&&t[n]!==r[n]&&e()})},onClose:function(n,e){return ModalStore.subscribe(function(t,r){return t[n]===!1&&t[n]!==r[n]&&e()})}}});customTag('modal',function(n){var e=n.name;e===void 0&&(e='default');var t=n.children;typeof e==='undefined'&&console.warn('[Radi.js] Warn: Every <modal> tag needs to have `name` attribute!');this.onMount=function(n){return ModalStore.dispatch(registerModal,e)};return h('portal',{},ModalStore(function(n){return n[e]&&h('div',{class:'radi-modal',name:e},h('div',{class:'radi-modal-backdrop',onclick:function(){return service.modal.close(e)}}),h.apply(void 0,['div',{class:'radi-modal-content'}].concat((t.slice()))))}))});customTag('portal',function(n){var e,t,r=n.children||[];this.onMount=function(u){mount(function(){this.onMount=function(n,r){e=n;t=r};return function(){return r}},n.on||document.body)};this.onDestroy=function(n,u){patch(t,null,r,0,e||n)};return null});var validValue=function(n){return typeof n==='string'||typeof n==='number'||n},Validator=function(n){this.value=n;this.rules=[]};Validator.prototype.register=function(n){var e=this,t=n.type,r=n.validate,u=n.error,i=this.rules.push({type:t,validate:function(n){return validValue(n)&&r(n)},error:u||'Invalid field'});this.error=function(n){e.rules[i-1].error=n||u;return e};return this};Validator.prototype.check=function(n){var e=this;typeof n!=='undefined'&&(this.value=n);return this.rules.reduce(function(n,t){return typeof n==='string'?n:!t.validate(e.value)&&t.error||n},!0)};Validator.prototype.required=function(){return this.register({type:'required',validate:function(n){return n!==''},error:'Field is required'})};Validator.prototype.test=function(n){return this.register({type:'test',validate:function(e){return e===''||n.test(e)},error:'Field must be valid'})};Validator.prototype.equal=function(n){return this.register({type:'equal',validate:function(e){return e===''||e===n},error:'Field must be equal to '+n})};Validator.prototype.notEqual=function(n){return this.register({type:'notEqual',validate:function(e){return e===''||e!==n},error:'Field must not be equal to '+n})};Validator.prototype.min=function(n){return this.register({type:'min',validate:function(e){return e.length>=n},error:'Min char length is '+n})};Validator.prototype.max=function(n){return this.register({type:'max',validate:function(e){return e.length<n},error:'Max char length is '+n})};Validator.prototype.email=function(){return this.register({type:'email',validate:function(n){return n===''||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)},error:'Email is not valid'})};var Radi={v:GLOBALS.VERSION,version:GLOBALS.VERSION,h:html,html:html,Store:Store,customTag:customTag,customAttribute:customAttribute,patch:patch,mount:mount,service:service,Subscribe:Subscribe,Validator:Validator};Radi.plugin=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return n.apply(void 0,[Radi].concat(e))};window&&(window.Radi=Radi);export default Radi