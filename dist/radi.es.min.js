let GLOBALS={HEADLESS_COMPONENTS:{},FROZEN_STATE:!1,VERSION:'0.3.6',ACTIVE_COMPONENTS:{},HTML_CACHE:{}};class Listener{constructor(e,...t){this.component=e;[this.key]=t;this.childPath=t.slice(1,t.length);this.path=t;this.value=null;this.changeListeners=[];this.processValue=e=>e;this.attatched=!0;this.component.addListener(this.key,this);this.component.state&&this.handleUpdate(this.component.state[this.key])}deattach(){this.component=null;this.attatched=!1;this.key=null;this.childPath=null;this.path=null;this.value=null;this.changeListeners=[];this.processValue=()=>{}}handleUpdate(e){this.value=this.processValue(this.getShallowValue(e),this.value);this.changeListeners.forEach(e=>e(this.value))}onValueChange(e){this.changeListeners.push(e);e(this.value)}process(e){this.processValue=e;this.handleUpdate(this.value);return this}getShallowValue(e){if(typeof e!=='object'||!this.childPath)return e;let t=e;for(let e of this.childPath)t===null||!t[e]&&typeof t[e]!=='number'?(t=null):(t=t[e]);return t}}class AttributeListener{constructor({attributeKey:e,listener:t,element:n}){this.attributeKey=e;this.listener=t;this.element=n;this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.attributeListeners||(this.element.attributeListeners=[]);this.element.attributeListeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;this.attributeKey==='model'&&(/(checkbox|radio)/.test(this.element.getAttribute('type'))?(this.element.onchange=e=>{this.listener.component[this.listener.key]=e.target.checked}):(this.element.oninput=e=>{this.listener.component[this.listener.key]=e.target.value}));return this}handleValueChange(e){this.attributeKey==='value'||this.attributeKey==='model'?(/(checkbox|radio)/.test(this.element.getAttribute('type'))?(this.element.checked=e):(this.element.value=e)):setAttributes(this.element,{[this.attributeKey]:e})}updateElement(e){this.element=e;return this.element}deattach(){this.attributeKey=null;this.listener.deattach();this.listener=null;this.element=null;this.listenerAsNode=null;this.attached=!1;this.handleValueChange=()=>{}}}class StyleListener{constructor({styleKey:e,listener:t,element:n}){this.styleKey=e;this.listener=t;this.element=n;this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.styleListeners||(this.element.styleListeners=[]);this.element.styleListeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;return this}handleValueChange(e){setStyle(this.element,this.styleKey,e)}updateElement(e){this.element=e;return this.element}deattach(){this.listener.deattach();this.styleKey=null;this.listener=null;this.element=null;this.attached=!1;this.handleValueChange=null}}let parseValue=e=>typeof e==='number'&&!Number.isNaN(e)?`${e}px`:e,setStyle=(e,t,n)=>{if(typeof n==='undefined')return void 0;if(n instanceof Listener){new StyleListener({styleKey:t,listener:n,element:e}).attach();return e[t]}return e.style[t]=parseValue(n)},setStyles=(e,t)=>{typeof t==='string'&&(e.style=t);if(typeof t!=='object'||Array.isArray(t)){return e.style}if(t instanceof Listener){new AttributeListener({attributeKey:'style',listener:t,element:e}).attach();return e.style}for(let n in t)setStyle(e,n,t[n]);return e.style},parseClass=e=>{if(Array.isArray(e)){return e.filter(e=>e).join(' ')}return e},setAttributes=(e,t)=>{for(let n in t){let r=t[n];if(typeof r==='undefined')continue;if(!r&&typeof r!=='number'){e.removeAttribute(n);continue}if(n.toLowerCase()==='style'){setStyles(e,r);continue}if(r instanceof Listener){new AttributeListener({attributeKey:n,listener:r,element:e}).attach();continue}if(n.toLowerCase()==='class'||n.toLowerCase()==='classname'){e.setAttribute('class',parseClass(r));continue}if(n.substring(0,2).toLowerCase()==='on'){n.substring(0,8).toLowerCase()==='onsubmit'?(e[n]=e=>{let t=[],n=e.target.elements||[];for(let e of n){if(e.name!==''){let n={name:e.name,el:e,type:e.type,default:e.defaultValue,value:e.value,set(e){this.el.value=e},reset(e){this.el.value=e;this.el.defaultValue=e}};t.push(n);Object.defineProperty(t,n.name,{value:n})}}return r(e,t)}):(e[n]=r);continue}e.setAttribute(n,r)}},getElementFromQuery=e=>{if(typeof e==='string')return e!=='template'?document.createElement(e):document.createDocumentFragment();console.warn('[Radi.js] Warn: Creating a JSX element whose query is not of type string, automatically converting query to string.');return document.createElement(e.toString())},generateId=()=>{let e='';for(let t=0;t<32;t++){let n=Math.random()*16|0;(t===8||t===12||t===16||t===20)&&(e+='-');e+=(t===12?4:t===16?n&3|8:n).toString(16)}return e};class PrivateStore{constructor(){this.store={}}addListener(e,t){typeof this.store[e]==='undefined'&&this.createItemWrapper(e);this.store[e].listeners=this.store[e].listeners.filter(e=>e.attatched);this.store[e].listeners.push(t);t.handleUpdate(this.store[e].value);return t}removeListeners(){let e=Object.keys(this.store);for(var t=0;t<e.length;t++)this.store[e[t]].listeners=[],this.store[e[t]].null=[]}setState(e){for(let t of Object.keys(e))typeof this.store[t]==='undefined'&&this.createItemWrapper(t),this.store[t].value=e[t],this.triggerListeners(t);return e}createItemWrapper(e){return this.store[e]={listeners:[],value:null}}triggerListeners(e){let t=this.store[e];t&&t.listeners.forEach(e=>e.handleUpdate(t.value))}}let copyAttrs=(e,t)=>{var n=t.attributes,r=e.attributes,l=null,a=null,s=null,u=null,i=null;if(r){for(var o=r.length-1;o>=0;--o)i=r[o],u=i.name,l=i.namespaceURI,a=i.value,l?(u=i.localName||u,s=t.getAttributeNS(l,u),s!==a&&t.setAttributeNS(l,u,a)):(t.hasAttribute(u)?(s=t.getAttribute(u),s!==a&&(a==='null'||a==='undefined'?t.removeAttribute(u):t.setAttribute(u,a))):t.setAttribute(u,a))}if(n){for(var c=n.length-1;c>=0;--c)i=n[c],i.specified!==!1&&(u=i.name,l=i.namespaceURI,l?(u=i.localName||u,e.hasAttributeNS(l,u)||t.removeAttributeNS(l,u)):(e.hasAttributeNS(null,u)||t.removeAttribute(u)))}},destroy=e=>{if(!(e instanceof Node))return;let t=document.createTreeWalker(e,NodeFilter.SHOW_ALL,e=>!0,!1),n;while(n=t.nextNode()){if(n.listeners){for(var r=0;r<n.listeners.length;r++)n.listeners[r].deattach()}n.listeners=null;if(n.attributeListeners){for(r=0;r<n.styleListeners.length;r++)n.styleListeners[r].deattach()}n.attributeListeners=null;if(n.styleListeners){for(r=0;r<n.styleListeners.length;r++)n.styleListeners[r].deattach()}n.styleListeners=null;n.destroy&&n.destroy();n.parentNode&&n.parentNode.removeChild(n)}if(e.listeners){for(r=0;r<e.listeners.length;r++)e.listeners[r].deattach()}e.listeners=null;if(e.attributeListeners){for(r=0;r<e.styleListeners.length;r++)e.styleListeners[r].deattach()}e.attributeListeners=null;if(e.styleListeners){for(r=0;r<e.styleListeners.length;r++)e.styleListeners[r].deattach()}e.parentNode&&e.parentNode.removeChild(e)},fuse=(e,t,n)=>{(Array.isArray(t)||Array.isArray(e))&&(n=!0);if(!n){let n=e.nodeType,r=t.nodeType;if(n===r&&(n===3||r===8)){e.isEqualNode(t)||(e.nodeValue=t.nodeValue,destroy(t));return e}if(t.destroy||e.destroy||t.__async||t.__async||e.listeners||t.listeners||n===3||r===3){e.isEqualNode(t)||(e.parentNode.insertBefore(t,e),destroy(e));return t}copyAttrs(t,e)}let r=[...e.childNodes||e],l=[...t.childNodes||t],a=Math.max(r.length,l.length);for(var s=0;s<a;s++)r[s]&&l[s]?fuse(r[s],l[s]):r[s]&&!l[s]?destroy(r[s]):!r[s]&&l[s]&&e.appendChild(l[s]);destroy(t);return e};class FuseDom{fuse(...e){return fuse(...e)}destroy(...e){return destroy(...e)}}var fuseDom=new FuseDom;let clone=e=>{if(typeof e!=='object')return e;if(e===null)return e;if(Array.isArray(e))return e.map(clone);let t={};for(let n in e)e.hasOwnProperty(n)&&(t[n]=clone(e[n]));return t},skipInProductionAndTest=e=>{if(typeof process==='undefined'||(process.env.NODE_ENV==='production'||process.env.NODE_ENV==='test')){return!1}return e&&e()};class Component{constructor(e,t){this.addNonEnumerableProperties({$id:generateId(),$name:this.constructor.name,$config:typeof this.config==='function'?this.config():{listen:!0},$events:{},$privateStore:new PrivateStore});this.on=typeof this.on==='function'?this.on():{};this.children=[];this.copyObjToInstance(GLOBALS.HEADLESS_COMPONENTS,'head');this.state=Object.assign(typeof this.state==='function'?this.state():{},t||{});skipInProductionAndTest(()=>Object.freeze(this.state));e&&this.setChildren(e)}render(){if(typeof this.view!=='function')return'';let e=this.view();if(Array.isArray(e)){for(let t=0;t<e.length;t++)e[t].destroy=this.destroy.bind(this)}else e.destroy=this.destroy.bind(this);this.html=e;return e}setProps(e){this.setState(e);return this}setChildren(e){this.children=e;this.setState();for(let e=0;e<this.children.length;e++)typeof this.children[e].when==='function'&&this.children[e].when('update',()=>this.setState());return this}copyObjToInstance(e,t){for(let n in e){if(typeof this[n]!=='undefined'){throw new Error(`[Radi.js] Error: Trying to write for reserved variable \`${n}\``)}this[n]=e[n];t==='head'&&this[n].when('update',()=>this.setState())}}addNonEnumerableProperties(e){for(let t in e){if(typeof this[t]!=='undefined')continue;Object.defineProperty(this,t,{value:e[t]})}}addListener(e,t){this.$privateStore.addListener(e,t)}mount(){this.trigger('mount')}destroy(){this.trigger('destroy');this.$privateStore.removeListeners()}when(e,t){typeof this.$events[e]==='undefined'&&(this.$events[e]=[]);this.$events[e].push(t)}trigger(e,...t){typeof this.on[e]==='function'&&this.on[e].call(this,...t);if(typeof this.$events[e]!=='undefined'){for(let n in this.$events[e])this.$events[e][n].call(this,...t)}}setState(e){if(typeof e==='object'){let t=clone(this.state);this.state=Object.assign(t,e);skipInProductionAndTest(()=>Object.freeze(this.state));this.$config.listen&&this.$privateStore.setState(e)};!this.$config.listen&&typeof this.view==='function'&&this.html&&fuseDom.fuse(this.html,this.view());this.trigger('update');return this.state}static isComponent(){return!0}}let mount=(e,t)=>{let n=document.createDocumentFragment(),r=typeof t==='string'?document.getElementById(t):t,l=e instanceof Component||e.render?e.render():e;if(Array.isArray(l)){for(var a=0;a<l.length;a++)mount(l[a],n)}else appendChild(n)(l);r.appendChild(n);typeof r.destroy!=='function'&&(r.destroy=()=>{for(var e=0;e<l.length;e++)fuseDom.destroy(l[e])});typeof e.mount==='function'&&e.mount();return r},ensureArray=e=>{if(Array.isArray(e))return e;return[e]},listenerToNode=e=>{if(e instanceof DocumentFragment){return Array.from(e.childNodes)}let t=document.createDocumentFragment();appendChildren(t,ensureArray(e));return listenerToNode(t)};class ElementListener{constructor({listener:e,element:t}){this.listener=e;this.element=t;this.listenerAsNode=[];this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.listeners||(this.element.listeners=[]);this.element.listeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;return this}handleValueChange(e){let t=listenerToNode(e);var n=0;for(let e of t)this.listenerAsNode[n]?(this.listenerAsNode[n]=fuseDom.fuse(this.listenerAsNode[n],e)):this.listenerAsNode.push(this.element.appendChild(e)),n+=1;if(n<this.listenerAsNode.length){var r=this.listenerAsNode.splice(n-this.listenerAsNode.length);for(let e of r)fuseDom.destroy(e)}}updateElement(e){this.element=e;return this.element}deattach(){this.listener.deattach();this.listener=null;this.element=null;this.listenerAsNode=null;this.attached=!1;this.handleValueChange=()=>{}}}let appendListenerToElement=(e,t)=>new ElementListener({listener:e,element:t}).attach(),appendChild=e=>t=>{!t&&typeof t!=='number'&&(t='');if(t instanceof Component){mount(t,e);return}if(t instanceof Listener){appendListenerToElement(t,e);return}if(Array.isArray(t)){appendChildren(e,t);return}if(typeof t==='function'){let n=t();if(n instanceof Promise){let t=document.createElement('selection'),r=e.appendChild(t);r.__async=!0;n.then(e=>{if(e.default&&e.default.isComponent)appendChild(r)(new e.default);else if(typeof e.default==='function'){let t=e.default();t.then(e=>{e.default&&e.default.isComponent&&appendChild(r)(new e.default)})}else appendChild(r)(e.default)}).catch(console.warn)}else appendChild(e)(n);return}if(t instanceof Node){e.appendChild(t);return}e.appendChild(document.createTextNode(t))},appendChildren=(e,t)=>{t.forEach(appendChild(e))},r=(e,t,...n)=>{if(typeof e==='function'&&e.isComponent){return new e(n).setProps(t||{})}if(typeof e==='function'){let r=t||{};r.children=n;return e(r)}let r=getElementFromQuery(e);t!==null&&setAttributes(r,t);appendChildren(r,n);return r},listen=(e,...t)=>new Listener(e,...t),remountActiveComponents=()=>{Object.values(GLOBALS.ACTIVE_COMPONENTS).forEach(e=>{typeof e.onMount==='function'&&e.onMount(e)})};function action(e,t,n){let r=n.value;n.value=function(...e){this.setState.call(this,r.call(this,...e))};return n}let Radi={version:GLOBALS.VERSION,activeComponents:GLOBALS.ACTIVE_COMPONENTS,r,listen,l:listen,component:Component,Component,action,headless:(e,t)=>{let n=new t;n.mount();return GLOBALS.HEADLESS_COMPONENTS['$'.concat(e)]=n},mount,freeze:()=>{GLOBALS.FROZEN_STATE=!0},unfreeze:()=>{GLOBALS.FROZEN_STATE=!1,remountActiveComponents()}};Radi.plugin=(e,...t)=>e(Radi,...t);window&&(window.Radi=Radi);export default Radi