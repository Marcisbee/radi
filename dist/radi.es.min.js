let GLOBALS={MIX:{},HEADLESS_COMPONENTS:{},FROZEN_STATE:!1,VERSION:'0.2.5',ACTIVE_COMPONENTS:{},HTML_CACHE:{}};class Listener{constructor(e,...n){this.component=e;[this.key]=n;this.childPath=n.slice(1,n.length);this.value=null;this.changeListeners=[];this.processValue=e=>e;this.component.addListener(this.key,this);this.handleUpdate(this.component[this.key])}handleUpdate(e){this.value=this.processValue(this.getShallowValue(e),this.value);this.changeListeners.forEach(e=>e(this.value))}onValueChange(e){this.changeListeners.push(e);e(this.value)}process(e){this.processValue=e;this.handleUpdate(this.value);return this}getShallowValue(e){if(!this.childPath)return e;let n=e;for(let e of this.childPath)n=n[e];return n}}class AttributeListener{constructor({attributeKey:e,listener:n,element:t}){this.attributeKey=e;this.listener=n;this.element=t;this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.attributeListeners||(this.element.attributeListeners=[]);this.element.attributeListeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;this.attributeKey==='model'&&(/(checkbox|radio)/.test(this.element.getAttribute('type'))?(this.element.onchange=e=>{this.listener.component[this.listener.key]=e.target.checked}):(this.element.oninput=e=>{this.listener.component[this.listener.key]=e.target.value}));return this}handleValueChange(e){this.attributeKey==='value'||this.attributeKey==='model'?(/(checkbox|radio)/.test(this.element.getAttribute('type'))?(this.element.checked=e):(this.element.value=e)):setAttributes(this.element,{[this.attributeKey]:e})}updateElement(e){this.element=e;return this.element}}class StyleListener{constructor({styleKey:e,listener:n,element:t}){this.styleKey=e;this.listener=n;this.element=t;this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.styleListeners||(this.element.styleListeners=[]);this.element.styleListeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;return this}handleValueChange(e){setStyle(this.element,this.styleKey,e)}updateElement(e){this.element=e;return this.element}}let parseValue=e=>typeof e==='number'&&!Number.isNaN(e)?`${e}px`:e,setStyle=(e,n,t)=>{if(typeof t==='undefined')return void 0;if(t instanceof Listener){new StyleListener({styleKey:n,listener:t,element:e}).attach();return e[n]}return e.style[n]=parseValue(t)},setStyles=(e,n)=>{typeof n==='string'&&(e.style=n);if(typeof n!=='object'||Array.isArray(n)){return e.style}if(n instanceof Listener){new AttributeListener({attributeKey:'style',listener:n,element:e}).attach();return e.style}for(let t in n)setStyle(e,t,n[t]);return e.style},setAttributes=(e,n)=>{for(let t in n){let r=n[t];if(typeof r==='undefined')continue;if(!r&&typeof r!=='number'){e.removeAttribute(t);continue}if(t==='style'){setStyles(e,r);continue}if(r instanceof Listener){new AttributeListener({attributeKey:t,listener:r,element:e}).attach();continue}if(t.substring(0,2).toLowerCase()==='on'){e[t]=r;continue}e.setAttribute(t,r)}},getElementFromQuery=e=>{if(typeof e==='string')return document.createElement(e);console.warn('[Radi.js] Warn: Creating a JSX element whose query is not of type string, automatically converting query to string.');return document.createElement(e.toString())},clone=e=>{if(typeof e!=='object')return e;if(e===null)return e;if(Array.isArray(e))return e.map(clone);let n={};for(let t in e)e.hasOwnProperty(t)&&(n[t]=clone(e[t]));return n},generateId=()=>{let e='';for(let n=0;n<32;n++){let t=Math.random()*16|0;(n===8||n===12||n===16||n===20)&&(e+='-');e+=(n===12?4:n===16?t&3|8:t).toString(16)}return e};class Renderer{constructor(e){this.component=e;this.html=document.createDocumentFragment();this.node={}}render(){this.html.appendChild(this.node=this.component.$view);this.html.destroy=this.node.destroy=()=>this.component.destroy();return this.html}destroyHtml(){this.node.childNodes&&this.node.childNodes.forEach(e=>{this.node.removeChild(e)});this.html.childNodes&&this.html.childNodes.forEach(e=>{this.html.removeChild(e)});this.html=document.createDocumentFragment();this.node={};return this.node}}function deepProxy(e,n){let t=new WeakMap;function r(e){return{set(t,r,o,a){typeof o==='object'&&(o=u(o,[...e,r]));t[r]=o;n.set&&n.set(t,[...e,r],o,a);return!0},deleteProperty(t,r){if(Reflect.has(t,r)){o(t,r);let u=Reflect.deleteProperty(t,r);u&&n.deleteProperty&&n.deleteProperty(t,[...e,r]);return u}return!1}}}function o(e,n){t.has(e[n])&&(e[n]=t.get(e[n]),t.delete(e[n]));for(let t of Object.keys(e[n]))typeof e[n][t]==='object'&&o(e[n],t)}function u(e,n){for(let t of Object.keys(e))typeof e[t]==='object'&&(e[t]=u(e[t],[...n,t]));let o=new Proxy(e,r(n));t.set(o,e);return o}return u(e,[])}class PrivateStore{constructor(){this.store={}}setItem(e,n){typeof this.store[e]==='undefined'&&this.createItemWrapper(e);e!=='children'&&n&&typeof n==='object'&&!(n instanceof Component)&&(n=deepProxy(n,{set:(n,t,r,o)=>{this.triggerListeners(e)},deleteProperty:(n,t)=>{this.triggerListeners(e)}}));this.store[e].value=n;this.triggerListeners(e);return n}getItem(e){return this.store[e].value}addListener(e,n){typeof this.store[e]==='undefined'&&this.createItemWrapper(e);this.store[e].listeners.push(n);n.handleUpdate(this.store[e].value);return n}createItemWrapper(e){return this.store[e]={listeners:[],value:null}}triggerListeners(e){let n=this.store[e];n.listeners.forEach(e=>e.handleUpdate(n.value))}}class Component{constructor(e,n){this.name=e.name;this.addNonEnumerableProperties(Object.assign({$id:generateId(),$mixins:e.mixins||{},$state:clone(e.state||{}),$props:clone(e.props||{}),$actions:e.actions||{},$privateStore:new PrivateStore}));this.addCustomField('children',[]);n&&this.setChildren(n);this.copyObjToInstance(this.$mixins);this.copyObjToInstance(this.$state);this.copyObjToInstance(this.$props);this.copyObjToInstance(GLOBALS.HEADLESS_COMPONENTS);this.copyObjToInstance(this.$actions,this.handleAction.bind(this));this.addNonEnumerableProperties({$view:e.view?e.view(this):()=>()=>null,$renderer:new Renderer(this)});this.$view.unmount=this.unmount.bind(this);this.$view.mount=this.mount.bind(this)}copyObjToInstance(e,n = e=>e){for(let t in e){if(typeof this[t]!=='undefined'){throw new Error(`[Radi.js] Error: Trying to write for reserved variable \`${t}\``)}this.addCustomField(t,n(e[t]))}}handleAction(e){return(...n)=>{if(GLOBALS.FROZEN_STATE)return null;return e.call(this,...n)}}setProps(e){for(let n in e){this.$props[n]=e[n];if(typeof this.$props[n]==='undefined'){console.warn(`[Radi.js] Warn: Creating a prop \`${n}\` that is not defined in component`);this.addCustomField(n,e[n]);continue}this[n]=e[n]}return this}setChildren(e){this.children=e;return this}addNonEnumerableProperties(e){for(let n in e){if(typeof this[n]!=='undefined')continue;Object.defineProperty(this,n,{value:e[n]})}}addCustomField(e,n){Object.defineProperty(this,e,{get:()=>this.$privateStore.getItem(e),set:n=>this.$privateStore.setItem(e,n),enumerable:!0});this[e]=n}addListener(e,n){this.$privateStore.addListener(e,n)}isMixin(e){return typeof this.$mixins[e]!=='undefined'}mount(){typeof this.$actions.onMount==='function'&&this.$actions.onMount.call(this,this);GLOBALS.ACTIVE_COMPONENTS[this.$id]=this}unmount(){typeof this.$actions.onDestroy==='function'&&this.$actions.onDestroy.call(this,this);delete GLOBALS.ACTIVE_COMPONENTS[this.$id]}render(){this.mount();return this.$renderer.render()}destroy(){this.unmount();return this.$renderer.destroyHtml()}static isComponent(){return!0}}let ensureArray=e=>{if(Array.isArray(e))return e;return[e]},swapNode=e=>{let n=e;e=n.cloneNode(!0);e.remove();return n},listenerToNode=e=>{if(e instanceof DocumentFragment){return Array.from(e.childNodes).map(e=>swapNode(e))}let n=document.createDocumentFragment();appendChildren(n,ensureArray(e));return listenerToNode(n)};class ElementListener{constructor({listener:e,element:n}){this.listener=e;this.element=n;this.listenerAsNode=[];this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.listeners||(this.element.listeners=[]);this.element.listeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;return this}handleValueChange(e){let n=listenerToNode(e);for(let e of n){if(!this.listenerAsNode[0]){this.element.appendChild(e);continue}this.element.insertBefore(e,this.listenerAsNode[0])}for(let e of this.listenerAsNode){var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,e=>e&&typeof e.destroy==='function',!1),r;while(r=t.nextNode())r.destroy();e.remove()}this.listenerAsNode=n}updateElement(e){this.element=e;return this.element}}let appendListenerToElement=(e,n)=>new ElementListener({listener:e,element:n}).attach(),appendChild=e=>n=>{!n&&typeof n!=='number'&&(n='');if(n instanceof Component){e.appendChild(n.render());return}if(n instanceof Listener){appendListenerToElement(n,e);return}if(Array.isArray(n)){appendChildren(e,n);return}if(typeof n==='function'){let t=document.createElement('div'),r=e.appendChild(t);n().then(e=>{typeof e.default==='function'&&e.default.isComponent&&e.default.isComponent()?appendChild(r)(new e.default):appendChild(r)(e.default)}).catch(()=>{});return}if(n instanceof Node){e.appendChild(n);return}e.appendChild(document.createTextNode(n))},appendChildren=(e,n)=>{n.forEach(appendChild(e))},r=(e,n,...t)=>{if(typeof e.isComponent==='function'&&e.isComponent()){return new e(t).setProps(n||{})}if(typeof e==='function'){let r=n||{};r.children=t;return e(r)}let r=getElementFromQuery(e);n!==null&&setAttributes(r,n);appendChildren(r,t);return r},listen=(e,...n)=>new Listener(e,...n),component=e=>class{constructor(n){return new Component(e,n)}static isComponent(){return!0}},mount=(e,n)=>{let t=typeof n==='string'?document.getElementById(n):n,r=e instanceof Component?e.render():e;t.appendChild(r);return r},remountActiveComponents=()=>{Object.values(GLOBALS.ACTIVE_COMPONENTS).forEach(e=>{typeof e.onMount==='function'&&e.onMount(e)})},_radi={version:GLOBALS.VERSION,activeComponents:GLOBALS.ACTIVE_COMPONENTS,r,listen,l:listen,component,headless:(e,n)=>{let t=new n;t.mount();return GLOBALS.HEADLESS_COMPONENTS['$'.concat(e)]=t},mount,freeze:()=>{GLOBALS.FROZEN_STATE=!0},unfreeze:()=>{GLOBALS.FROZEN_STATE=!1,remountActiveComponents()}};_radi.plugin=(e,...n)=>e(_radi,...n);window&&(window.$Radi=_radi);module.exports=_radi