var GLOBALS={VERSION:'0.5.0',CUSTOM_ATTRIBUTES:{},CUSTOM_TAGS:{},SERVICES:{}};function capitalise(n){return n.charAt(0).toUpperCase()+n.substr(1)}function ensureArray(n){if(arguments.length===0){return[]}if(arguments.length===1){if(n===void 0||n===null){return[]}if(Array.isArray(n)){return n}}return Array.prototype.slice.call(arguments)}function flatten(n){return n.reduce(function(n,e){return n.concat(Array.isArray(e)?flatten(e):e)},[])}var isValidElement=function(n){return n.name&&(n.value||n.value==='')},isValidValue=function(n){return!['checkbox','radio'].includes(n.type)||n.checked},isCheckbox=function(n){return n.type==='checkbox'},isMultiSelect=function(n){return n.options&&n.multiple},getSelectValues=function(n){return[].reduce.call(n,function(n,e){return e.selected?n.concat(e.value):n},[])},formToJSON=function(n,e){e===void 0&&(e=function(n,e){return e});return[].reduce.call(n,function(n,t){isValidElement(t)&&isValidValue(t)&&(isCheckbox(t)?(n[t.name]=(n[t.name]||[]).concat(e(t,t.value))):isMultiSelect(t)?(n[t.name]=e(t,getSelectValues(t))):(n[t.name]=e(t,t.value)));return n},{})},Component=function(n,e){this.self=n;this.name=e||n.name;this.__$events={}};Component.prototype.on=function(n,e){var t=this.__$events,r="on"+(capitalise(n));t[r]||(t[r]=[]);t[r].push(e);return e};Component.prototype.trigger=function(n){var e,t,r=[],i=arguments.length-1;while(i-->0)r[i]=arguments[i+1];var o="on"+(capitalise(n));(this.__$events[o]||[]).map(function(n){return n.apply(void 0,r)});typeof this[o]==='function'&&(e=this)[o].apply(e,r);typeof this.self[o]==='function'&&(t=this.self)[o].apply(t,r)};function service(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];if(typeof n!=='string'){throw new Error('[Radi.js] Service first argument has to be string')}if(typeof e!=='function'){throw new Error('[Radi.js] Service second argument has to be function')}var i='$'.concat(n),o=e.apply(void 0,t);Component.prototype[i]=o;return GLOBALS.SERVICES[i]=o}function destroyTree$$1(n){fireEvent('destroy',n);if(n.nodeType===1){var e=n.firstChild;while(e)destroyTree$$1(e),e=e.nextSibling}}function fireEvent(n,e){var t=document.createEvent('Event');t.initEvent(n,!0,!0);typeof e.dispatchEvent==='function'&&(e._eventFired=!0,e.dispatchEvent(t));return e}function insertAfter(n,e,t){t||(t=e.parentNode);if(n instanceof Node){if(e===null||e===void 0){return t.insertBefore(n,e)}if(e instanceof Node){return t.insertBefore(n,e.nextSibling)}}return n}function nodeChanged(n,e){if(n===void 0||e===void 0){return!1}if(typeof n!==typeof e){return!0}if((typeof n==='string'||typeof n==='number')&&n!==e){return!0}if(n.type!==e.type){return!0}if(n.props){return!0}return!1}function autoUpdate(n,e){if(typeof n==='function'&&n.__radiStateUpdater){return n(e)}return e(n)}function setBooleanProp(n,e,t){t?(n.setAttribute(e,t),n[e]=!0):(n[e]=!1)}function removeBooleanProp(n,e){n.removeAttribute(e);n[e]=!1}function isEventProp(n){return /^on/.test(n)}function extractEventName(n){return n.slice(2).toLowerCase()}function isCustomProp(n){return isEventProp(n)}function setProp(n,e,t){if(typeof GLOBALS.CUSTOM_ATTRIBUTES[e]!=='undefined'){var r=GLOBALS.CUSTOM_ATTRIBUTES[e],i=r.allowedTags,o=r.addToElement,u=r.caller;if(!i||i&&i.length>0&&i.indexOf(n.localName)>=0){typeof u==='function'&&(t=u(n,t));if(!o){return}}}e==='style'?setStyles(n,t):isCustomProp(e)?addEventListener(n,e,t):e==='className'?n.setAttribute('class',t):typeof t==='boolean'?setBooleanProp(n,e,t):n.setAttribute(e,t)}function removeProp(n,e,t){isCustomProp(e)||(e==='className'?n.removeAttribute('class'):typeof t==='boolean'?removeBooleanProp(n,e):n.removeAttribute(e))}function setStyles(n,e){Object.keys(e).forEach(function(t){autoUpdate(e[t],function(e){n.style[t]=e})})}function setProps(n,e){Object.keys(e).forEach(function(t){autoUpdate(e[t],function(e){(t==='class'||t==='className')&&(Array.isArray(e)&&(e=e.filter(function(n){return n&&typeof n!=='function'}).join(' ')));setProp(n,t,e)})})}function updateProp(n,e,t,r){t?(!r||t!==r)&&setProp(n,e,t):removeProp(n,e,r)}function updateProps(n,e,t){t===void 0&&(t={});var r=Object.assign({},e,t);Object.keys(r).forEach(function(r){autoUpdate(e[r],function(e){updateProp(n,r,e,t[r])})})}function addEventListener(n,e,t){var r=['mount','destroy'];isEventProp(e)&&n.addEventListener(extractEventName(e),function(i){r.indexOf(e)>=0?(n===i.target&&t(i)):t(i)},!1)}function beforeDestroy(n,e){if(typeof n.beforedestroy==='function'){return n.beforedestroy(e)}return e()}function patch(n,e,t,r,i){r===void 0&&(r=0);var o=n&&n.childNodes[r];i&&(r=Array.prototype.indexOf.call(n.childNodes,i)+1);var u=flatten(ensureArray(e)),c=flatten(ensureArray(t)),l=u.length,a=c.length,d=0,f=function(e){u[e] instanceof Date&&(u[e]=u[e].toString());if(c[e]===!1||c[e]===void 0||c[e]===null)o=createElement$$1(u[e],n),i?insertAfter(o,n.childNodes[(r+e-1)],n):n.appendChild(o),fireEvent('mount',o);else if(u[e]===!1||u[e]===void 0||u[e]===null){var t=n.childNodes[r+e+d];t&&beforeDestroy(t,function(){var t=n.childNodes[r+e+d];n.removeChild(t);destroyTree$$1(t);d-=1})}else if(nodeChanged(u[e],c[e]))n.replaceChild(o=createElement$$1(u[e],n),n.childNodes[r+e]),fireEvent('mount',o);else if(typeof u[e].type==='string'){var l=u[e],a=c[e];updateProps(n.childNodes[r+e],l.props,a.props);var f=l.children.length,s=a.children.length;for(var p=0;p<f||p<s;p++)patch(n.childNodes[r+e],l.children[p],a.children[p],p)}};for(var s=0;s<l||s<a;s++)f(s);return u}function mount(n,e){return{component:n,node:patch(e,n),destroy:function(){return patch(e,null,n)}}}function createElement$$1(n,e){if(typeof n==='string'||typeof n==='number'){return document.createTextNode(n)}if(n===void 0||n===!1||n===null){return document.createComment('')}if(Array.isArray(n)){var t=document.createTextNode('');t.addEventListener('mount',function(){for(var t=0;t<n.length;t++)mount(n[t],e)});return t}if(typeof n==='function'||typeof n.type==='function'){var r=n.type||n,i=new Component(r),o=createElement$$1(r.call(i,Object.assign({},(n.props||{}),{children:n.children||[]})),e),u;o&&typeof o.addEventListener==='function'&&(o.addEventListener('mount',function(){typeof i.style==='string'&&(u=document.createElement('style'),u.innerHTML=i.style,document.head.appendChild(u));i.trigger('mount',o,e)},{passive:!0,once:!0},!1),o.addEventListener('destroy',function(){i.trigger('destroy',o,e);u instanceof Node&&document.head.removeChild(u)},{passive:!0,once:!0},!1));return o}if(typeof n==='object'){if(n.type){var c;n.type==='svg'||e instanceof SVGElement?(c=document.createElementNS('http://www.w3.org/2000/svg',n.type)):(c=document.createElement(n.type));var l=null;setProps(c,n.props);var a=function(n){return function(e){var t=createElement$$1(e,n);t&&(l?insertAfter(t,l,n):(n.appendChild.call(c,t),fireEvent('mount',t)))}};n.children.map(a(c));return c}return createElement$$1(JSON.stringify(n),e)}return document.createTextNode((""+n))}function customAttribute(n,e,t){t===void 0&&(t={});var r=t.allowedTags,i=t.addToElement;return GLOBALS.CUSTOM_ATTRIBUTES[n]={name:n,caller:e,allowedTags:r||null,addToElement:i}}function customTag(n,e){return GLOBALS.CUSTOM_TAGS[n]={name:n,render:e||(function(){})}}function html(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];var i=n;typeof GLOBALS.CUSTOM_TAGS[n]!=='undefined'&&(i=GLOBALS.CUSTOM_TAGS[n].render);return{type:typeof i==='number'?""+i:i,props:e||{},children:flatten(t)}}function setDataInObject(n,e,t){var r=e[0],i={};i[r]=n[r];var o=i,u=0;while(u<e.length-1)o=o[e[u++]];o[e[u]]=t;return i}function mapData(n,e,t,r){r===void 0&&(r=[]);var i={};n&&n.$loading&&Object.defineProperty(i,'$loading',{value:!0,writable:!0});t||(t=i);var o=function(o){var u=o;typeof n[o]==='function'?(i[u]=n[o].call(e,function(n,i,o){o===void 0&&(o='');var c=setDataInObject(t,r.concat(u),n);if(!i){var l=function(){return c};Object.defineProperty(l,'name',{value:o,writable:!1});e.dispatch(l)}else e.update(c)})):(i[u]=n[u]&&typeof n[u]==='object'&&!Array.isArray(n[u])?mapData(n[u],e,t,r.concat(u)):n[u])};for(var u in n)o(u);return i}function Store(n){n===void 0&&(n={});var e=[],t=[],r;function i(n){n===void 0&&(n=function(n){return n});var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];if(this instanceof Component){return o.render(n)}if(this&&this.name==='StoreHold'&&typeof e[0]==='function'){o.subscribe(e[0],!0);n(r,!0);return r}var i;function u(e){if(typeof e==='function')o.subscribe(function(t){var r=n(t);i!==r&&e(r)}),e(i=n(r),!0);else{var t=o.render(n);return t}return i}u.__radiStateUpdater=!0;return u.apply(void 0,e)}function o(n){function e(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return i.call.apply(i,[this,n].concat(e))}e.__radiStateUpdater=!0;return e}o.getInitial=function(){return u};o.get=function(){return r};o.update=function(n,i){var u=Object.assign({},r,mapData(n,o));r=u;i||t.map(function(n){typeof n==='function'&&n(u);return!1});e.map(function(n){typeof n==='function'&&n(u);return!1});return r};o.subscribe=function(n,i){i?t.push(n):e.push(n);n(r);return o};o.dispatch=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];var i=n.apply(void 0,[r].concat(e));return o.update(i)};o.render=function(n){n===void 0&&(n=function(n){return JSON.stringify(n)});var t,i,o,u,c=!1;function l(e){o=n(e);patch(t,o,u,0,i);u=o;return e}e.push(function(n){c&&l(n);return n});function a(){this.onMount=function(n,e){c=!0;i=n;t=e||n.parentNode;l(r)};return''}return a};var u=mapData(n,o);r=u;return o}function applyLoading(n,e){typeof n==='object'&&Object.defineProperty(n,'$loading',{value:e,writable:!0});return n}function Fetch(n,e){return function(n){return function(t){setTimeout(t,1e3,applyLoading(e({user:{_key:n.id}}),!1));return applyLoading({$loading:!0},!0)}}}function Subscribe(n){n===void 0&&(n=document);return{on:function(e,t){t===void 0&&(t=function(n){return n});var r=e.trim().split(' '),i=null,o=null,u=null,c=!1;if(typeof t!=='function'){throw new Error(("[Radi.js] Subscription `"+e+"` must be transformed by function"))}function l(e){return function(l){c=!0;o=e;u=l;r.map(function(e){return n.addEventListener(e,i=function(){var n=[],r=arguments.length;while(r--)n[r]=arguments[r];return l(t.apply(void 0,n.concat([e])),!1,("Subscribe: "+e))})});return e}}l.stop=function(){c&&r.map(function(e){return n.removeEventListener(e,i)});return c=!c};l.start=function(){return!c&&l(o)(u)};return l}}}var animate=function(n,e,t,r){var i=t[e];if(typeof i!=='function'){console.warn(("[Radi.js] Animation `"+e+"` for node `"+n.nodeName.toLowerCase+"` should be function"));return}return i(n,r)};customAttribute('animation',function(n,e){animate(n,'in',e,function(){});n.beforedestroy=function(t){return animate(n,'out',e,t)}});customAttribute('html',function(n,e){n.addEventListener('mount',function(){n.escape?(n.textContent=e):(n.innerHTML=e)})});customAttribute('loadfocus',function(n){n.addEventListener('mount',function(){return n.focus()})});customAttribute('model',function(n,e){console.log(e,e instanceof Store)},{allowedTags:['input','textarea','select']});customAttribute('onsubmit',function(n,e){return function(t){n.prevent&&t.preventDefault();e(t,formToJSON(n.elements||{}))}},{allowedTags:['form'],addToElement:!0});var errorsStore=new Store({},'errorStore'),setErrors=function(n,e,t){var r;return(Object.assign({},n,(r={}, r[e]=t, r)))};function fullValidate(n,e,t){var r=formToJSON(n,function(n,e){var t=n.touched;return({touched:t,value:e})}),i=[];for(var o in r){var u=r[o];if(typeof e[o]==='function'){var c=e[o](u.value),l=c&&typeof c.check==='function'&&c.check()||c||o+' field is invalid';l!==!0&&i.push({touched:Boolean(u.touched),error:l})}}t(i)}var formCount=0;customAttribute('onvalidate',function(n,e){var t=n.name||'defaultForm'+formCount++,r;function i(n){errorsStore.dispatch(setErrors,t,n)}errorsStore.subscribe(function(n){r&&(r.disabled=n[t].length>0)});n.addEventListener('mount',function(n){var t=e(n),o=n.target.elements;if(t&&typeof t==='object'&&o){for(var u of o){var c=u.name;if(!u.__radiValidate&&typeof c==='string'&&typeof t[c]==='function'){u.addEventListener('input',function(){fullValidate(o,t,i)});u.__radiValidate=!0;u.touched=!1;var l=function(n){var e=n.target;e.touched=!0;e.removeEventListener('change',l);fullValidate(o,t,i)};u.addEventListener('change',l)}u.type==='submit'&&u.disabled===!0&&(r=u)}fullValidate(o,t,i)}},!1)},{allowedTags:['form']});customTag('errors',function(n){var e=n.name,t=n.onrender;typeof e==='undefined'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `name` attribute!');typeof t==='function'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `onrender` attribute!');return errorsStore(function(n){return n[e]&&t(n[e])})});var h=html,ModalStore=new Store({}),registerModal=function(n,e){var t;return(t={}, t[e]=!1, t)},switchModal=function(n,e,t){var r;return(r={}, r[e]=t, r)},ModalService=service('modal',function(){var n=[],e=arguments.length;while(e--)n[e]=arguments[e];return{open:function(n){return ModalStore.dispatch(switchModal,n,!0)},close:function(n){return ModalStore.dispatch(switchModal,n,!1)}}});customTag('modal',function(n){var e=this,t=n.name;t===void 0&&(t='default');var r=n.children;typeof t==='undefined'&&console.warn('[Radi.js] Warn: Every <modal> tag needs to have `name` attribute!');this.style="\n      .--radi-modal {\n        display: block;\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        z-index: 1000;\n      }\n      .--radi-modal-backdrop {\n        display: block;\n        position: absolute;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        z-index: 0;\n        background-color: rgba(0, 0, 0, 0.7);\n      }\n      .--radi-modal-content {\n        display: block;\n        position: relative;\n        width: 600px;\n        max-width: 98%;\n        z-index: 1;\n        margin: 40px auto;\n        border-radius: 8px;\n        box-shadow: 0 5px 0px rgba(0, 0, 0, 0.1), 0 20px 50px rgba(0, 0, 0, 0.3);\n        background-color: #fff;\n        padding: 26px;\n      }\n    ";this.onMount=function(n){return ModalStore.dispatch(registerModal,t)};return h('portal',{},ModalStore(function(n){return n[t]&&h('div',{class:'--radi-modal',name:t},h('div',{class:'--radi-modal-backdrop',onclick:function(){return e.$modal.close(t)}}),h.apply(void 0,['div',{class:'--radi-modal-content'}].concat((r.slice()))))}))});customTag('portal',function(n){var e,t,r=n.children||[];this.onMount=function(i){mount(function(){this.onMount=function(n,r){e=n;t=r};return function(){return r}},n.on||document.body)};this.onDestroy=function(n,i){patch(t,null,r,0,e||n)};return null});var Validator=function(n){this.value=n;this.rules=[]};Validator.prototype.register=function(n){var e=this,t=n.type,r=n.validate,i=n.error,o=this.rules.push({type:t,validate:function(n){return n&&r(n)},error:i||'Invalid field'});this.error=function(n){e.rules[o-1].error=n||i;return e};return this};Validator.prototype.check=function(n){var e=this;typeof n!=='undefined'&&(this.value=n);return this.rules.reduce(function(n,t){return typeof n==='string'?n:!t.validate(e.value)&&t.error||n},!0)};Validator.prototype.required=function(){return this.register({type:'required',validate:function(n){return n!==''},error:'Field is required'})};Validator.prototype.equal=function(n){return this.register({type:'equal',validate:function(e){return e===n},error:'Field must be equal to '+n})};Validator.prototype.min=function(n){return this.register({type:'min',validate:function(e){return e.length>=n},error:'Min char length is '+n})};Validator.prototype.max=function(n){return this.register({type:'max',validate:function(e){return e.length<n},error:'Max char length is '+n})};Validator.prototype.email=function(){return this.register({type:'email',validate:function(n){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)},error:'Email is not valid'})};var Radi={v:GLOBALS.VERSION,version:GLOBALS.VERSION,h:html,Fetch:Fetch,html:html,Store:Store,customTag:customTag,customAttribute:customAttribute,patch:patch,mount:mount,service:service,Subscribe:Subscribe,Validator:Validator};Radi.plugin=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return n.apply(void 0,[Radi].concat(e))};window&&(window.Radi=Radi);export default Radi