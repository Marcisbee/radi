let GLOBALS={HEADLESS_COMPONENTS:{},FROZEN_STATE:!1,VERSION:'0.3.0',ACTIVE_COMPONENTS:{},HTML_CACHE:{}};class Listener{constructor(e,...t){this.component=e;[this.key]=t;this.childPath=t.slice(1,t.length);this.path=t;this.value=null;this.changeListeners=[];this.processValue=e=>e;this.disabled=!1;this.component.addListener(this.key,this);this.component.state&&this.handleUpdate(this.component.state[this.key])}extract(e){if(e.value instanceof Listener){e.value.disabled=!0;return this.extract(e.value)}return e}handleUpdate(e){this.value=this.processValue(this.getShallowValue(e),this.value);if(this.disabled){typeof this.disabled==='function'&&this.disabled(this.value);return this.value}if(this.value instanceof Listener){if(this.value.disabled)return this.value;this.value=this.extract(this.value);this.value.disabled=e=>{this.changeListeners.forEach(t=>t(e))}}this.changeListeners.forEach(e=>e(this.value));return this.value}onValueChange(e){this.changeListeners.push(e);e(this.value)}process(e){this.processValue=e;this.handleUpdate(this.value);return this}getShallowValue(e){if(typeof e!=='object'||!this.childPath)return e;let t=e;for(let e of this.childPath)t===null||!t[e]&&typeof t[e]!=='number'?(t=null):(t=t[e]);return t}}class AttributeListener{constructor({attributeKey:e,listener:t,element:n}){this.attributeKey=e;this.listener=t;this.element=n;this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.attributeListeners||(this.element.attributeListeners=[]);this.element.attributeListeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;this.attributeKey==='model'&&(/(checkbox|radio)/.test(this.element.getAttribute('type'))?(this.element.onchange=e=>{this.listener.component[this.listener.key]=e.target.checked}):(this.element.oninput=e=>{this.listener.component[this.listener.key]=e.target.value}));return this}handleValueChange(e){this.attributeKey==='value'||this.attributeKey==='model'?(/(checkbox|radio)/.test(this.element.getAttribute('type'))?(this.element.checked=e):(this.element.value=e)):setAttributes(this.element,{[this.attributeKey]:e})}updateElement(e){this.element=e;return this.element}}class StyleListener{constructor({styleKey:e,listener:t,element:n}){this.styleKey=e;this.listener=t;this.element=n;this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.styleListeners||(this.element.styleListeners=[]);this.element.styleListeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;return this}handleValueChange(e){setStyle(this.element,this.styleKey,e)}updateElement(e){this.element=e;return this.element}}let parseValue=e=>typeof e==='number'&&!Number.isNaN(e)?`${e}px`:e,setStyle=(e,t,n)=>{if(typeof n==='undefined')return void 0;if(n instanceof Listener){new StyleListener({styleKey:t,listener:n,element:e}).attach();return e[t]}return e.style[t]=parseValue(n)},setStyles=(e,t)=>{typeof t==='string'&&(e.style=t);if(typeof t!=='object'||Array.isArray(t)){return e.style}if(t instanceof Listener){new AttributeListener({attributeKey:'style',listener:t,element:e}).attach();return e.style}for(let n in t)setStyle(e,n,t[n]);return e.style},parseClass=e=>{if(Array.isArray(e)){return e.filter(e=>e).join(' ')}return e},setAttributes=(e,t)=>{for(let n in t){let r=t[n];if(typeof r==='undefined')continue;if(!r&&typeof r!=='number'){e.removeAttribute(n);continue}if(n.toLowerCase()==='style'){setStyles(e,r);continue}if(r instanceof Listener){new AttributeListener({attributeKey:n,listener:r,element:e}).attach();continue}if(n.toLowerCase()==='class'||n.toLowerCase()==='classname'){e.setAttribute('class',parseClass(r));continue}if(n.substring(0,2).toLowerCase()==='on'){n.substring(0,8).toLowerCase()==='onsubmit'?(e[n]=e=>{let t=[],n=e.target.elements||[];for(let e of n){if(e.name!==''){let n={name:e.name,el:e,type:e.type,default:e.defaultValue,value:e.value,set(e){this.el.value=e},reset(e){this.el.value=e;this.el.defaultValue=e}};t.push(n);Object.defineProperty(t,n.name,{value:n})}}return r(e,t)}):(e[n]=r);continue}e.setAttribute(n,r)}},getElementFromQuery=e=>{if(typeof e==='string')return e!=='template'?document.createElement(e):document.createDocumentFragment();console.warn('[Radi.js] Warn: Creating a JSX element whose query is not of type string, automatically converting query to string.');return document.createElement(e.toString())},generateId=()=>{let e='';for(let t=0;t<32;t++){let n=Math.random()*16|0;(t===8||t===12||t===16||t===20)&&(e+='-');e+=(t===12?4:t===16?n&3|8:n).toString(16)}return e};class PrivateStore{constructor(){this.store={}}addListener(e,t){typeof this.store[e]==='undefined'&&this.createItemWrapper(e);this.store[e].listeners.push(t);t.handleUpdate(this.store[e].value);return t}setState(e){for(let t of Object.keys(e))typeof this.store[t]==='undefined'&&this.createItemWrapper(t),this.store[t].value=e[t],this.triggerListeners(t);return e}createItemWrapper(e){return this.store[e]={listeners:[],value:null}}triggerListeners(e){let t=this.store[e];t&&t.listeners.forEach(e=>e.handleUpdate(t.value))}}let copyAttrs=(e,t)=>{var n=t.attributes,r=e.attributes,a=null,l=null,u=null,s=null,o=null;for(var i=r.length-1;i>=0;--i)o=r[i],s=o.name,a=o.namespaceURI,l=o.value,a?(s=o.localName||s,u=t.getAttributeNS(a,s),u!==l&&t.setAttributeNS(a,s,l)):(t.hasAttribute(s)?(u=t.getAttribute(s),u!==l&&(l==='null'||l==='undefined'?t.removeAttribute(s):t.setAttribute(s,l))):t.setAttribute(s,l));for(var c=n.length-1;c>=0;--c)o=n[c],o.specified!==!1&&(s=o.name,a=o.namespaceURI,a?(s=o.localName||s,e.hasAttributeNS(a,s)||t.removeAttributeNS(a,s)):(e.hasAttributeNS(null,s)||t.removeAttribute(s)))},destroyNode=e=>{var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,e=>e&&(typeof e.destroy==='function'||e.listeners),!1),n;while(n=t.nextNode())n.listeners=null,n.destroy(),n.parentNode.removeChild(n);e.parentNode.removeChild(e)},fuseDom=(e,t,n)=>{(Array.isArray(t)||Array.isArray(e))&&(n=!0);if(!n){let n=e.nodeType,r=t.nodeType;if(n===r&&(n===3||r===8)){e.isEqualNode(t)||(e.nodeValue=t.nodeValue,destroyNode(t));return e}if(e.listeners||t.listeners||n===3||r===3){e.isEqualNode(t)||(e.parentNode.insertBefore(t,e),destroyNode(e));return t}copyAttrs(t,e)}let r=[...e.childNodes||e],a=[...t.childNodes||t],l=Math.max(r.length,a.length);for(var u=0;u<l;u++)r[u]&&a[u]?fuseDom(r[u],a[u]):r[u]&&!a[u]?destroyNode(r[u]):!r[u]&&a[u]&&e.appendChild(a[u]);return e},clone=e=>{if(typeof e!=='object')return e;if(e===null)return e;if(Array.isArray(e))return e.map(clone);let t={};for(let n in e)e.hasOwnProperty(n)&&(t[n]=clone(e[n]));return t};class Component{constructor(e,t){this.addNonEnumerableProperties({$id:generateId(),$name:this.constructor.name,$config:typeof this.config==='function'?this.config():{listen:!0},$store:{},$events:{},$privateStore:new PrivateStore});this.on=typeof this.on==='function'?this.on():{};this.children=[];this.copyObjToInstance(GLOBALS.HEADLESS_COMPONENTS,'head');this.state=Object.assign(typeof this.state==='function'?this.state():{},t||{});e&&this.setChildren(e)}render(){if(typeof this.view!=='function')return'';let e=this.view();this.html=e;return e}setProps(e){this.setState(e);return this}setChildren(e){this.children=e;this.setState();for(let e=0;e<this.children.length;e++)typeof this.children[e].when==='function'&&this.children[e].when('update',()=>this.setState());return this}copyObjToInstance(e,t){for(let n in e){if(typeof this[n]!=='undefined'){throw new Error(`[Radi.js] Error: Trying to write for reserved variable \`${n}\``)}this[n]=e[n];t==='head'&&this[n].when('update',()=>this.setState())}}addNonEnumerableProperties(e){for(let t in e){if(typeof this[t]!=='undefined')continue;Object.defineProperty(this,t,{value:e[t]})}}addListener(e,t){this.$privateStore.addListener(e,t)}mount(){this.trigger('mount')}destroy(){this.trigger('destroy');this.html&&this.html!==''&&this.html.remove()}when(e,t){typeof this.$events[e]==='undefined'&&(this.$events[e]=[]);this.$events[e].push(t)}trigger(e,t){typeof this.on[e]==='function'&&this.on[e].call(this,t);if(typeof this.$events[e]!=='undefined'){for(let n in this.$events[e])this.$events[e][n].call(this,t)}}setState(e){if(typeof e==='object'){let t=clone(this.state);this.state=Object.assign(t,e);this.$config.listen&&this.$privateStore.setState(e)};!this.$config.listen&&typeof this.view==='function'&&this.html&&fuseDom(this.html,this.view());this.trigger('update');return this.state}static isComponent(){return!0}}let ensureArray=e=>{if(Array.isArray(e))return e;return[e]},swapNode=e=>{let t=e;e=t.cloneNode(!0);e.remove();return t},listenerToNode=e=>{if(e instanceof DocumentFragment){return Array.from(e.childNodes).map(e=>swapNode(e))}let t=document.createDocumentFragment();appendChildren(t,ensureArray(e));return listenerToNode(t)};class ElementListener{constructor({listener:e,element:t}){this.listener=e;this.element=t;this.listenerAsNode=[];this.attached=!1;this.handleValueChange=this.handleValueChange.bind(this)}attach(){this.element.listeners||(this.element.listeners=[]);this.element.listeners.push(this);this.listener.onValueChange(this.handleValueChange);this.attached=!0;return this}handleValueChange(e){let t=listenerToNode(e);var n=0;for(let e of t)this.listenerAsNode[n]?(this.listenerAsNode[n]=fuseDom(this.listenerAsNode[n],e)):this.listenerAsNode.push(this.element.appendChild(e)),n+=1;if(n<this.listenerAsNode.length){var r=this.listenerAsNode.splice(n-this.listenerAsNode.length);for(let e of r)e.remove()}}updateElement(e){this.element=e;return this.element}}let appendListenerToElement=(e,t)=>new ElementListener({listener:e,element:t}).attach(),appendChild=e=>t=>{!t&&typeof t!=='number'&&(t='');if(t instanceof Component){e.appendChild(t.render());t.mount();return}if(t instanceof Listener){appendListenerToElement(t,e);return}if(Array.isArray(t)){appendChildren(e,t);return}if(typeof t==='function'){let n=document.createElement('div'),r=e.appendChild(n);r.__async=!0;t().then(e=>{typeof e.default==='function'&&e.default.isComponent&&e.default.isComponent()?(appendChild(r)(new e.default),r.__async=!1):(appendChild(r)(e.default),r.__async=!1)}).catch(console.warn);return}if(t instanceof Node){e.appendChild(t);return}e.appendChild(document.createTextNode(t))},appendChildren=(e,t)=>{t.forEach(appendChild(e))},r=(e,t,...n)=>{if(typeof e==='function'&&e.isComponent){return new e(n).setProps(t||{})}if(typeof e==='function'){let r=t||{};r.children=n;return e(r)}let r=getElementFromQuery(e);t!==null&&setAttributes(r,t);appendChildren(r,n);return r},listen=(e,...t)=>new Listener(e,...t),mount=(e,t)=>{let n=document.createDocumentFragment(),r=typeof t==='string'?document.getElementById(t):t,a=e instanceof Component||e.render?e.render():e;if(Array.isArray(a)){for(var l=0;l<a.length;l++)mount(a[l],n)}else n.appendChild(a);r.appendChild(n);typeof e.mount==='function'&&e.mount();return a},remountActiveComponents=()=>{Object.values(GLOBALS.ACTIVE_COMPONENTS).forEach(e=>{typeof e.onMount==='function'&&e.onMount(e)})};function action(e,t,n){let r=n.value;n.value=function(...e){this.setState.call(this,r.call(this,...e))};return n}let Radi={version:GLOBALS.VERSION,activeComponents:GLOBALS.ACTIVE_COMPONENTS,r,listen,l:listen,component:Component,Component,action,headless:(e,t)=>{let n=new t;n.mount();return GLOBALS.HEADLESS_COMPONENTS['$'.concat(e)]=n},mount,freeze:()=>{GLOBALS.FROZEN_STATE=!0},unfreeze:()=>{GLOBALS.FROZEN_STATE=!1,remountActiveComponents()}};Radi.plugin=(e,...t)=>e(Radi,...t);window&&(window.$Radi=Radi);module.exports=Radi