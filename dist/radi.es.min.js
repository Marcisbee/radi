var GLOBALS={VERSION:'0.5.0',CUSTOM_ATTRIBUTES:{},CUSTOM_TAGS:{},SERVICES:{}};function capitalise(n){return n.charAt(0).toUpperCase()+n.substr(1)}function ensureArray(n){if(arguments.length===0){return[]}if(arguments.length===1){if(n===void 0||n===null){return[]}if(Array.isArray(n)){return n}}return Array.prototype.slice.call(arguments)}function flatten(n){return n.reduce(function(n,t){return n.concat(Array.isArray(t)?flatten(t):t)},[])}var isValidElement=function(n){return n.name&&(n.value||n.value==='')},isValidValue=function(n){return!['checkbox','radio'].includes(n.type)||n.checked},isCheckbox=function(n){return n.type==='checkbox'},isMultiSelect=function(n){return n.options&&n.multiple},getSelectValues=function(n){return[].reduce.call(n,function(n,t){return t.selected?n.concat(t.value):n},[])},formToJSON=function(n,t){t===void 0&&(t=function(n,t){return t});return[].reduce.call(n,function(n,e){isValidElement(e)&&isValidValue(e)&&(isCheckbox(e)?(n[e.name]=(n[e.name]||[]).concat(t(e,e.value))):isMultiSelect(e)?(n[e.name]=t(e,getSelectValues(e))):(n[e.name]=t(e,e.value)));return n},{})},Component=function(n,t){this.self=n;this.name=t||n.name;this.__$events={}};Component.prototype.on=function(n,t){var e=this.__$events,r="on"+(capitalise(n));e[r]||(e[r]=[]);e[r].push(t);return t};Component.prototype.trigger=function(n){var t,e,r=[],u=arguments.length-1;while(u-->0)r[u]=arguments[u+1];var i="on"+(capitalise(n));(this.__$events[i]||[]).map(function(n){return n.apply(void 0,r)});typeof this[i]==='function'&&(t=this)[i].apply(t,r);typeof this.self[i]==='function'&&(e=this.self)[i].apply(e,r)};function service(n,t){var e=[],r=arguments.length-2;while(r-->0)e[r]=arguments[r+2];if(typeof n!=='string'){throw new Error('[Radi.js] Service first argument has to be string')}if(typeof t!=='function'){throw new Error('[Radi.js] Service second argument has to be function')}var u='$'.concat(n),i=t.apply(void 0,e);Component.prototype[u]=i;return GLOBALS.SERVICES[u]=i}function destroyTree$$1(n){fireEvent('destroy',n);if(n.nodeType===1){var t=n.firstChild;while(t)destroyTree$$1(t),t=t.nextSibling}}function fireEvent(n,t){var e=document.createEvent('Event');e.initEvent(n,!0,!0);typeof t.dispatchEvent==='function'&&(t._eventFired=!0,t.dispatchEvent(e));return t}function insertAfter(n,t,e){e||(e=t.parentNode);if(n instanceof Node){if(t===null||t===void 0){return e.insertBefore(n,t)}if(t instanceof Node){return e.insertBefore(n,t.nextSibling)}}return n}function nodeChanged(n,t){if(n===void 0||t===void 0){return!1}if(typeof n!==typeof t){return!0}if((typeof n==='string'||typeof n==='number')&&n!==t){return!0}if(n.type!==t.type){return!0}if(n.props){return!0}return!1}function autoUpdate(n,t){if(typeof n==='function'&&n.__radiStateUpdater){return n(t)}return t(n)}function setBooleanProp(n,t,e){e?(n.setAttribute(t,e),n[t]=!0):(n[t]=!1)}function removeBooleanProp(n,t){n.removeAttribute(t);n[t]=!1}function isEventProp(n){return /^on/.test(n)}function extractEventName(n){return n.slice(2).toLowerCase()}function isCustomProp(n){return isEventProp(n)}function setProp(n,t,e){if(typeof GLOBALS.CUSTOM_ATTRIBUTES[t]!=='undefined'){var r=GLOBALS.CUSTOM_ATTRIBUTES[t],u=r.allowedTags,i=r.addToElement,o=r.caller;if(!u||u&&u.length>0&&u.indexOf(n.localName)>=0){typeof o==='function'&&(e=o(n,e));if(!i){return}}}t==='style'?setStyles(n,e):isCustomProp(t)?addEventListener(n,t,e):t==='className'?n.setAttribute('class',e):typeof e==='boolean'?setBooleanProp(n,t,e):(t==='value'&&document.activeElement!==n&&(n[t]=e),n.setAttribute(t,e))}function removeProp(n,t,e){isCustomProp(t)||(t==='className'?n.removeAttribute('class'):typeof e==='boolean'?removeBooleanProp(n,t):n.removeAttribute(t))}function setStyles(n,t){Object.keys(t).forEach(function(e){autoUpdate(t[e],function(t){n.style[e]=t})})}function setProps(n,t){Object.keys(t).forEach(function(e){autoUpdate(t[e],function(t){e==='model'?(e='value'):(e==='class'||e==='className')&&(Array.isArray(t)&&(t=t.filter(function(n){return n&&typeof n!=='function'}).join(' ')));setProp(n,e,t)})})}function updateProp(n,t,e,r){e?(!r||e!==r)&&setProp(n,t,e):removeProp(n,t,r)}function updateProps(n,t,e){e===void 0&&(e={});var r=Object.assign({},t,e);Object.keys(r).forEach(function(r){autoUpdate(t[r],function(t){r==='model'&&(r='value');updateProp(n,r,t,e[r])})})}function addEventListener(n,t,e){var r=['mount','destroy'];isEventProp(t)&&n.addEventListener(extractEventName(t),function(u){r.indexOf(t)>=0?(n===u.target&&e(u)):e(u)},!1)}function beforeDestroy(n,t){if(typeof n.beforedestroy==='function'){return n.beforedestroy(t)}return t()}function patch(n,t,e,r,u){r===void 0&&(r=0);var i=n&&n.childNodes[r];u&&(r=Array.prototype.indexOf.call(n.childNodes,u)+1);var o=flatten(ensureArray(t)),c=flatten(ensureArray(e)),l=o.length,a=c.length,f=0,d=function(t){o[t] instanceof Date&&(o[t]=o[t].toString());if(c[t]===!1||c[t]===void 0||c[t]===null)i=createElement$$1(o[t],n),u?insertAfter(i,n.childNodes[(r+t-1)],n):n.appendChild(i),fireEvent('mount',i);else if(o[t]===!1||o[t]===void 0||o[t]===null){var e=n.childNodes[r+t+f];e&&beforeDestroy(e,function(){var e=n.childNodes[r+t+f];n.removeChild(e);destroyTree$$1(e);f-=1})}else if(nodeChanged(o[t],c[t]))n.replaceChild(i=createElement$$1(o[t],n),n.childNodes[r+t]),fireEvent('mount',i);else if(typeof o[t].type==='string'){var l=o[t],a=c[t];updateProps(n.childNodes[r+t],l.props,a.props);var d=l.children.length,s=a.children.length;for(var h=0;h<d||h<s;h++)patch(n.childNodes[r+t],l.children[h],a.children[h],h)}};for(var s=0;s<l||s<a;s++)d(s);return o}function mount(n,t){return{component:n,node:patch(t,n),destroy:function(){return patch(t,null,n)}}}function createElement$$1(n,t){if(typeof n==='string'||typeof n==='number'){return document.createTextNode(n)}if(n===void 0||n===!1||n===null){return document.createComment('')}if(Array.isArray(n)){var e=document.createTextNode('');e.addEventListener('mount',function(){for(var e=0;e<n.length;e++)mount(n[e],t)});return e}if(typeof n==='function'||typeof n.type==='function'){var r=n.type||n,u=new Component(r),i=createElement$$1(r.call(u,Object.assign({},(n.props||{}),{children:n.children||[]})),t),o;i&&typeof i.addEventListener==='function'&&(i.addEventListener('mount',function(){typeof u.style==='string'&&(o=document.createElement('style'),o.innerHTML=u.style,document.head.appendChild(o));u.trigger('mount',i,t)},{passive:!0,once:!0},!1),i.addEventListener('destroy',function(){u.trigger('destroy',i,t);o instanceof Node&&document.head.removeChild(o)},{passive:!0,once:!0},!1));return i}if(typeof n==='object'){if(n.type){var c;n.type==='svg'||t instanceof SVGElement?(c=document.createElementNS('http://www.w3.org/2000/svg',n.type)):(c=document.createElement(n.type));var l=null;setProps(c,n.props);var a=function(n){return function(t){var e=createElement$$1(t,n);e&&(l?insertAfter(e,l,n):(n.appendChild.call(c,e),fireEvent('mount',e)))}};n.children.map(a(c));return c}return createElement$$1(JSON.stringify(n),t)}return document.createTextNode((""+n))}function customAttribute(n,t,e){e===void 0&&(e={});var r=e.allowedTags,u=e.addToElement;return GLOBALS.CUSTOM_ATTRIBUTES[n]={name:n,caller:t,allowedTags:r||null,addToElement:u}}function customTag(n,t){return GLOBALS.CUSTOM_TAGS[n]={name:n,render:t||(function(){})}}function html(n,t){var e=[],r=arguments.length-2;while(r-->0)e[r]=arguments[r+2];var u=typeof n==='number'?""+n:n,i=t||{},o=flatten(e);u instanceof Promise&&(u='await',i={src:n});typeof GLOBALS.CUSTOM_TAGS[u]!=='undefined'&&(u=GLOBALS.CUSTOM_TAGS[u].render);return{type:u,props:i,children:o}}function setDataInObject(n,t,e){var r=t[0],u={};u[r]=n[r];var i=u,o=0;while(o<t.length-1)i=i[t[o++]];i[t[o]]=e;return u}function getDataFromObject(n,t){var e=0;while(e<n.length)typeof t==='undefined'?e++:(t=t[n[e++]]);return t}function updateState(n,t,e,r,u,i){i===void 0&&(i='');var o=setDataInObject(t,e,r);if(!u){var c=function(){return o};Object.defineProperty(c,'name',{value:i,writable:!1});n.dispatch(c)}else n.update(o)}function mapData(n,t,e,r){r===void 0&&(r=[]);var u={};n&&n.$loading&&Object.defineProperty(u,'$loading',{value:!0,writable:!0});e||(e=u);var i=function(i){var o=i;typeof n[i]==='function'?(u[o]=n[i].call(t,function(n,u,i){i===void 0&&(i='');updateState(t,e,r.concat(o),n,u,i)})):(u[o]=n[o]&&typeof n[o]==='object'&&!Array.isArray(n[o])?mapData(n[o],t,e,r.concat(o)):n[o])};for(var o in n)i(o);return u}function Store(n){n===void 0&&(n={});var t=[],e=[],r;function u(n){n===void 0&&(n=function(n){return n});var t=[],e=arguments.length-1;while(e-->0)t[e]=arguments[e+1];if(this instanceof Component){return i.render(n)}if(this&&this.name==='StoreHold'&&typeof t[0]==='function'){i.subscribe(t[0],!0);n(r,!0);return r}var u;function o(t){if(typeof t==='function')i.subscribe(function(e){var r=n(e);u!==r&&t(r)}),t(u=n(r),!0);else{var e=i.render(n);return e}return u}o.__radiStateUpdater=!0;return o.apply(void 0,t)}function i(n){function t(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];return u.call.apply(u,[this,n].concat(t))}t.__radiStateUpdater=!0;return t}i.getInitial=function(){return o};i.get=function(){return r};i.update=function(n,u){var o=r,c=Object.assign({},r,mapData(n,i));r=c;u||e.map(function(n){typeof n==='function'&&n(c,o);return!1});t.map(function(n){typeof n==='function'&&n(c,o);return!1});return r};i.subscribe=function(n,u){u?e.push(n):t.push(n);n(r);return i};i.bind=function(n,t,e){t===void 0&&(t=function(n){return n});e===void 0&&(e=function(n){return n});var u=Array.isArray(n)?n:n.split('.'),o=function(n){return t(getDataFromObject(u,n))},c=function(t){return updateState(i,r,u,e(t),!1,("Bind:"+n))};return{model:i(o),oninput:function(n){return c(n.target.value)}}};i.dispatch=function(n){var t=[],e=arguments.length-1;while(e-->0)t[e]=arguments[e+1];var u=n.apply(void 0,[r].concat(t));return i.update(u)};i.render=function(n){n===void 0&&(n=function(n){return JSON.stringify(n)});var e,u,i,o,c=!1;function l(t){i=n(t);patch(e,i,o,0,u);o=i;return t}t.push(function(n){c&&l(n);return n});function a(){this.onMount=function(n,t){c=!0;u=n;e=t||n.parentNode;l(r)};return''}return a};var o=mapData(n,i);r=o;return i}function Subscribe(n){n===void 0&&(n=document);return{on:function(t,e){e===void 0&&(e=function(n){return n});var r=t.trim().split(' '),u=null,i=null,o=null,c=!1;if(typeof e!=='function'){throw new Error(("[Radi.js] Subscription `"+t+"` must be transformed by function"))}function l(t){return function(l){c=!0;i=t;o=l;r.map(function(t){return n.addEventListener(t,u=function(){var n=[],r=arguments.length;while(r--)n[r]=arguments[r];return l(e.apply(void 0,n.concat([t])),!1,("Subscribe: "+t))})});return t}}l.stop=function(){c&&r.map(function(t){return n.removeEventListener(t,u)});return c=!c};l.start=function(){return!c&&l(i)(o)};return l}}}var animate=function(n,t,e,r){var u=e[t];if(typeof u!=='function'){console.warn(("[Radi.js] Animation `"+t+"` for node `"+n.nodeName.toLowerCase+"` should be function"));return}return u(n,r)};customAttribute('animation',function(n,t){animate(n,'in',t,function(){});n.beforedestroy=function(e){return animate(n,'out',t,e)}});customAttribute('html',function(n,t){n.addEventListener('mount',function(){n.escape?(n.textContent=t):(n.innerHTML=t)})});customAttribute('loadfocus',function(n){n.addEventListener('mount',function(){return n.focus()})});customAttribute('onsubmit',function(n,t){return function(e){n.prevent&&e.preventDefault();t(e,formToJSON(n.elements||{}))}},{allowedTags:['form'],addToElement:!0});var errorsStore=new Store({},'errorStore'),setErrors=function(n,t,e){var r;return(Object.assign({},n,(r={}, r[t]=e, r)))};function fullValidate(n,t,e){var r=formToJSON(n,function(n,t){var e=n.touched;return({touched:e,value:t})}),u=Object.keys(r).reduce(function(n,t){var e;return(Object.assign({},n,(e={}, e[t]=r[t].value, e)))},{}),i=[];for(var o in r){var c=r[o];if(typeof t[o]==='function'){var l=t[o](c.value,u),a=l&&typeof l.check==='function'&&l.check()||l||o+' field is invalid';a!==!0&&i.push({touched:Boolean(c.touched),error:a})}}e(i)}var formCount=0;customAttribute('onvalidate',function(n,t){var e=n.name||'defaultForm'+formCount++,r;function u(n){errorsStore.dispatch(setErrors,e,n)}errorsStore.subscribe(function(n){r&&(r.disabled=n[e].length>0)});n.addEventListener('mount',function(n){var e=t(n),i=n.target.elements;if(e&&typeof e==='object'&&i){for(var o of i){var c=o.name;if(!o.__radiValidate&&typeof c==='string'&&typeof e[c]==='function'){o.addEventListener('input',function(){fullValidate(i,e,u)});o.__radiValidate=!0;o.touched=!1;var l=function(n){var t=n.target;t.touched=!0;t.removeEventListener('change',l);fullValidate(i,e,u)};o.addEventListener('change',l)}o.type==='submit'&&o.disabled===!0&&(r=o)}fullValidate(i,e,u)}},!1)},{allowedTags:['form']});function ensureFn(n){if(typeof n==='function'){return n}return function(t){return n||t}}customTag('await',function(n){var t=n.src,e=new Store({status:'placeholder'}),r=function(n,t){return({status:t})};if(t&&(t instanceof Promise||t.constructor.name==='LazyPromise')){var u='';t.then(function(n){u=n;e.dispatch(r,'transform')}).catch(function(n){u=n;e.dispatch(r,'error')});return e(function(t){var e=t.status;return ensureFn(n[e])(u)})}return null});customTag('errors',function(n){var t=n.name,e=n.onrender;typeof t==='undefined'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `name` attribute!');typeof e!=='function'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `onrender` attribute!');return errorsStore(function(n){return n[t]&&e(n[t])})});var h=html,ModalStore=new Store({}),registerModal=function(n,t){var e;return(e={}, e[t]=!1, e)},switchModal=function(n,t,e){var r;return(r={}, r[t]=e, r)},ModalService=service('modal',function(){var n=[],t=arguments.length;while(t--)n[t]=arguments[t];return{open:function(n){return ModalStore.dispatch(switchModal,n,!0)},close:function(n){return ModalStore.dispatch(switchModal,n,!1)},onOpen:function(n,t){return ModalStore.subscribe(function(e,r){return e[n]===!0&&e[n]!==r[n]&&t()})},onClose:function(n,t){return ModalStore.subscribe(function(e,r){return e[n]===!1&&e[n]!==r[n]&&t()})}}});customTag('modal',function(n){var t=this,e=n.name;e===void 0&&(e='default');var r=n.children;typeof e==='undefined'&&console.warn('[Radi.js] Warn: Every <modal> tag needs to have `name` attribute!');this.onMount=function(n){return ModalStore.dispatch(registerModal,e)};return h('portal',{},ModalStore(function(n){return n[e]&&h('div',{class:'radi-modal',name:e},h('div',{class:'radi-modal-backdrop',onclick:function(){return t.$modal.close(e)}}),h.apply(void 0,['div',{class:'radi-modal-content'}].concat((r.slice()))))}))});customTag('portal',function(n){var t,e,r=n.children||[];this.onMount=function(u){mount(function(){this.onMount=function(n,r){t=n;e=r};return function(){return r}},n.on||document.body)};this.onDestroy=function(n,u){patch(e,null,r,0,t||n)};return null});var validValue=function(n){return typeof n==='string'||typeof n==='number'||n},Validator=function(n){this.value=n;this.rules=[]};Validator.prototype.register=function(n){var t=this,e=n.type,r=n.validate,u=n.error,i=this.rules.push({type:e,validate:function(n){return validValue(n)&&r(n)},error:u||'Invalid field'});this.error=function(n){t.rules[i-1].error=n||u;return t};return this};Validator.prototype.check=function(n){var t=this;typeof n!=='undefined'&&(this.value=n);return this.rules.reduce(function(n,e){return typeof n==='string'?n:!e.validate(t.value)&&e.error||n},!0)};Validator.prototype.required=function(){return this.register({type:'required',validate:function(n){return n!==''},error:'Field is required'})};Validator.prototype.test=function(n){return this.register({type:'test',validate:function(t){return t===''||n.test(t)},error:'Field must be valid'})};Validator.prototype.equal=function(n){return this.register({type:'equal',validate:function(t){return t===''||t===n},error:'Field must be equal to '+n})};Validator.prototype.notEqual=function(n){return this.register({type:'notEqual',validate:function(t){return t===''||t!==n},error:'Field must not be equal to '+n})};Validator.prototype.min=function(n){return this.register({type:'min',validate:function(t){return t.length>=n},error:'Min char length is '+n})};Validator.prototype.max=function(n){return this.register({type:'max',validate:function(t){return t.length<n},error:'Max char length is '+n})};Validator.prototype.email=function(){return this.register({type:'email',validate:function(n){return n===''||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)},error:'Email is not valid'})};var Radi={v:GLOBALS.VERSION,version:GLOBALS.VERSION,h:html,html:html,Store:Store,customTag:customTag,customAttribute:customAttribute,patch:patch,mount:mount,service:service,Subscribe:Subscribe,Validator:Validator};Radi.plugin=function(n){var t=[],e=arguments.length-1;while(e-->0)t[e]=arguments[e+1];return n.apply(void 0,[Radi].concat(t))};window&&(window.Radi=Radi);export default Radi