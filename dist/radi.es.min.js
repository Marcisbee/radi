var GLOBALS={HEADLESS_COMPONENTS:{},FROZEN_STATE:!1,VERSION:'0.3.23',ACTIVE_COMPONENTS:{},CUSTOM_ATTRIBUTES:{}},flatten=function e(t){return t.reduce((t,n)=>t.concat(Array.isArray(n)?e(n):n),[])},generateId=()=>{var e='';for(var t=0;t<32;t++){var n=Math.random()*16|0;(t===8||t===12||t===16||t===20)&&(e+='-');e+=(t===12?4:t===16?n&3|8:n).toString(16)}return e},PrivateStore=function(){this.store={}};PrivateStore.prototype.addListener=function(e,t,n){typeof this.store[e]==='undefined'&&this.createItemWrapper(e);this.store[e].listeners[n]=(this.store[e].listeners[n]||[]).filter(e=>e.attached);this.store[e].listeners[n].push(t);return t};PrivateStore.prototype.removeListeners=function(){var e=Object.keys(this.store);for(var t=0;t<e.length;t++)this.store[e[t]].listeners={},this.store[e[t]].value=null};PrivateStore.prototype.setState=function(e){for(var t of Object.keys(e))typeof this.store[t]==='undefined'&&this.createItemWrapper(t),this.store[t].value=e[t],this.triggerListeners(t);return e};PrivateStore.prototype.createItemWrapper=function(e){return this.store[e]={listeners:{},value:null}};PrivateStore.prototype.triggerListeners=function(e){var t=this.store[e];if(t){var n=Object.keys(t.listeners).sort().map(e=>(t.listeners[e].map(e=>e)));for(var r=0;r<n.length;r++){for(var o=n[r].length-1;o>=0;o--)n[r][o].attached&&n[r][o].handleUpdate(t.value)}}};var clone=e=>{if(typeof e!=='object'){return e}if(e===null){return e}if(Array.isArray(e)){return e.map(clone)}var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=clone(e[n]));return t},skipInProductionAndTest=e=>{if(typeof process==='undefined'||(process.env.NODE_ENV==='production'||process.env.NODE_ENV==='test')){return!1}return e&&e()},Listener=function(e,...t){var n;this.component=e;(n=t, this.key=n[0]);this.path=t.slice(1,t.length);this.depth=0;this.attached=!0;this.processValue=e=>e;this.changeListener=()=>{};this.addedListeners=[]};Listener.prototype.init=function(){this.value=this.getValue(this.component.state[this.key]);this.component.addListener(this.key,this,this.depth);this.handleUpdate(this.component.state[this.key]);return this};Listener.prototype.unlink=function(){this.value instanceof Node||this.value instanceof Listener&&this.value.deattach()};Listener.prototype.clone=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var o in t)n[o]=t[o];return n};Listener.prototype.setPartialState=function(e,t,n){var r={};if(e.length){r[e[0]]=e.length>1?this.setPartialState(e.slice(1),t,n[e[0]]):t;return this.clone(n,r)}return t};Listener.prototype.updateValue=function(e){var t=this.component.state[this.key];return this.component.setState({[this.key]:this.setPartialState(this.path,e,t)})};Listener.prototype.extractListeners=function(e){if(e instanceof Listener){var t={depth:e.depth,attached:!0,processValue:e=>e,handleUpdate:()=>{this.component&&this.handleUpdate(this.getValue(this.component.state[this.key])),t.attached=!1},changeListener:()=>{}};this.addedListeners.push(t);e.component.addListener(e.key,t,e.depth);var n=e.processValue(e.getValue(e.component.state[e.key]));e.deattach();return this.extractListeners(n)}return e};Listener.prototype.handleUpdate=function(e){var t=this.processValue(this.getValue(e));if(t instanceof Listener){for(var n=0;n<this.addedListeners.length;n++)this.addedListeners[n].attached=!1;this.addedListeners=[];this.value=this.extractListeners(t);this.changeListener(this.value)}else this.unlink(),this.value=t,this.changeListener(this.value)};Listener.prototype.getValue=function(e){var t=0;while(t<this.path.length)e===null||!e[this.path[t]]&&typeof e[this.path[t]]!=='number'?(e=null):(e=e[this.path[t]]),t+=1;return e};Listener.prototype.applyDepth=function(e){this.depth=e;return this};Listener.prototype.onValueChange=function(e){this.changeListener=e;this.changeListener(this.value)};Listener.prototype.process=function(e){this.processValue=e;return this};Listener.prototype.deattach=function(){this.component=null;this.attached=!1;this.key=null;this.childPath=null;this.path=null;this.unlink();this.value=null;this.changeListener=()=>{};this.processValue=()=>{}};var append=(e,t,n)=>{if(n&&t){t.parentNode&&t.parentNode.insertBefore(e,t);return e}return t.appendChild(e)},getLast=e=>{if(e.$redirect&&e.$redirect[e.$redirect.length-1]){return getLast(e.$redirect[e.$redirect.length-1])}return e},mountChildren=(e,t,n)=>{n===void 0&&(n=0);if(!e){return}e.$redirect&&e.$redirect.length>0?mountChildren(getLast(e),t,n+1):e.children&&e.children.length>0&&(e.html&&e.html.length===1?mount(e.children,e.html[0],e.html[0].nodeType!==1,e.$isSvg,e.$depth):mount(e.children,e.$pointer,!0,e.$isSvg,e.$depth))},textNode=e=>(document.createTextNode((typeof e==='object'?JSON.stringify(e):e))),mount=(e,t,n,r,o)=>{n===void 0&&(n=!1);r===void 0&&(r=!1);o===void 0&&(o=0);t=typeof t==='string'?document.getElementById(t):t;var i=flatten([e]).map(filterNode),l=function(e){var l=i[e];l instanceof Node?append(l,t,n):l&&typeof l.render==='function'&&(l.$pointer=textNode(''),append(l.$pointer,t,n),i[e].render(e=>{if(l.$pointer===!1){return!1}for(var r=0;r<e.length;r++)l.$pointer?append(e[r],l.$pointer,!0):append(e[r],t,n);mountChildren(l,l.$isSvg,o+1)},l,o,r))};for(var u=0;u<i.length;u++)l(u);return i},getElementFromQuery=(e,t)=>{if(typeof e==='string'||typeof e==='number'){return e!=='template'?t||e==='svg'?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e):document.createDocumentFragment()}console.warn('[Radi.js] Warn: Creating a JSX element whose query is not of type string, automatically converting query to string.');return document.createElement(e.toString())},explode=(e,t,n,r,o)=>{r===void 0&&(r=0);var i=flatten([e]).map(filterNode);for(var l=0;l<i.length;l++)i[l] instanceof Structure&&!i[l].html&&(t.children.length<=0&&(t.$redirect?t.$redirect.push(i[l]):(t.$redirect=[i[l]])),!t.$redirect&&i[l].children&&(t.children=t.children.concat(i[l].children)),typeof i[l].render==='function'&&i[l].render(e=>{n(e)},i[l],r+1,o));return},parseValue=e=>typeof e==='number'&&!Number.isNaN(e)?`${e}px`:e,setStyles=(e,t,n)=>{t===void 0&&(t={});n===void 0&&(n={});if(!e.html||!e.html[0]){return t}var r=e.html[0];if(t instanceof Listener){if(typeof e.$styleListeners.general!=='undefined'){return r.style}e.$styleListeners.general=t;e.$styleListeners.general.applyDepth(e.depth).init();e.$styleListeners.general.onValueChange(t=>{setStyles(e,t,{})});return r.style}if(typeof t==='string'){r.style=t;return r.style}var o=Object.keys(n).filter(e=>typeof t[e]==='undefined'),i=function(o){if(t.hasOwnProperty(o)){if(typeof n!=='undefined'&&n[o]===t[o]){return}if(!t[o]&&typeof t[o]!=='number'){r.style[o]=null;return}if(t[o] instanceof Listener){if(typeof e.$styleListeners[o]!=='undefined'){return}e.$styleListeners[o]=t[o];e.$styleListeners[o].applyDepth(e.depth).init();e.$styleListeners[o].onValueChange(t=>{setStyles(e,{[o]:t},{})});t[o]=e.$styleListeners[o].value;return}r.style[o]=parseValue(t[o])}};for(var l in t)i(l);for(var u=0;u<o.length;u++)r.style[o[u]]=null;return r.style},parseClass=e=>{if(Array.isArray(e)){return e.filter(e=>e).join(' ')}return e},setAttributes=(e,t,n)=>{t===void 0&&(t={});n===void 0&&(n={});var r=t||{},o=n||{};if(!e.html||!e.html[0]){return e}var i=e.html[0];if(!(i instanceof Node&&i.nodeType!==3)){return e}var l=Object.keys(o).filter(e=>typeof r[e]==='undefined'),u=function(t){if(r.hasOwnProperty(t)){if(typeof o!=='undefined'&&o[t]===r[t]){return}if(!r[t]&&typeof r[t]!=='number'){i.removeAttribute(t);return}(t==='value'||t==='model')&&!(r[t] instanceof Listener)&&(/(checkbox|radio)/.test(i.getAttribute('type'))?(i.checked=r[t]):(i.value=r[t]));if(r[t] instanceof Listener){if(typeof e.$attrListeners[t]!=='undefined'){return}e.$attrListeners[t]=r[t];r[t].applyDepth(e.depth).init();t.toLowerCase()==='model'&&(/(checkbox|radio)/.test(i.getAttribute('type'))?i.addEventListener('change',n=>{e.$attrListeners[t].updateValue(n.target.checked)}):i.addEventListener('input',n=>{e.$attrListeners[t].updateValue(n.target.value)}));e.$attrListeners[t].onValueChange(n=>{setAttributes(e,{[t]:n},{})});r[t]=e.$attrListeners[t].value;return}if(typeof GLOBALS.CUSTOM_ATTRIBUTES[t]!=='undefined'){var n=GLOBALS.CUSTOM_ATTRIBUTES[t],l=n.allowedTags;if(!l||l&&l.length>0&&l.indexOf(i.localName)>=0){typeof GLOBALS.CUSTOM_ATTRIBUTES[t].caller==='function'&&GLOBALS.CUSTOM_ATTRIBUTES[t].caller(i,r[t]);if(!GLOBALS.CUSTOM_ATTRIBUTES[t].addToElement){return}}}if(t.toLowerCase()==='style'){typeof r[t]==='object'?setStyles(e,r[t],o&&o.style||{}):(i.style=r[t]);return}if(t.toLowerCase()==='class'||t.toLowerCase()==='classname'){i.setAttribute('class',parseClass(r[t]));return}if(t.toLowerCase()==='loadfocus'){i.onload=e=>{setTimeout(()=>{e.focus()},10)};return}if(t.toLowerCase()==='html'){i.innerHTML=r[t];return}if(t.substring(0,2).toLowerCase()==='on'&&typeof r[t]==='function'){var u=r[t];t.substring(0,8).toLowerCase()==='onsubmit'?(i[t]=t=>{var n=[],r=t.target.elements||[];for(var o of r){if(o.name!==''&&(o.type!=='radio'&&o.type!=='checkbox')||o.checked){var i={name:o.name,el:o,type:o.type,default:o.defaultValue,value:o.value,set(t){e.el.value=t},reset(t){e.el.value=t;e.el.defaultValue=t}};n.push(i);n[i.name]||Object.defineProperty(n,i.name,{value:i})}}return u(t,n)}):(i[t]=e=>u(e));return}i.setAttribute(t,r[t])}};for(var s in r)u(s);for(var a=0;a<l.length;a++)i.removeAttribute(l[a]);e.props=r;return e},Structure=function(e,t,n,r){t===void 0&&(t={});r===void 0&&(r=0);this.query=e;this.props=Boolean!==t?t:{};isComponent(e)||e instanceof Component?(this.$compChildren=flatten(n||[]).map(filterNode),this.children=[]):(this.children=flatten(n||[]).map(filterNode),this.$compChildren=[]);this.html=null;this.$attrListeners=[];this.$styleListeners=[];this.$pointer=null;this.$component=null;this.$listener=null;this.$redirect=null;this.$destroyed=!1;this.$isSvg=e==='svg';this.$depth=r};Structure.prototype.mount=function(){this.$destroyed=!1;this.$component instanceof Component&&this.$component.mount()};Structure.prototype.destroy=function(e){e===void 0&&(e=!0);if(this.$destroyed){return!1}for(var t in this.$styleListeners)this.$styleListeners[t]&&typeof this.$styleListeners[t].deattach==='function'&&this.$styleListeners[t].deattach();for(var n in this.$attrListeners)this.$attrListeners[n]&&typeof this.$attrListeners[n].deattach==='function'&&this.$attrListeners[n].deattach();if(this.$redirect){for(var r=0;r<this.$redirect.length;r++)typeof this.$redirect[r].destroy==='function'&&this.$redirect[r].destroy()}if(e&&this.children){for(var o=0;o<this.children.length;o++)typeof this.children[o].destroy==='function'&&this.children[o].destroy()}if(this.html){for(var i=0;i<this.html.length;i++)this.html[i].parentNode&&this.html[i].parentNode.removeChild(this.html[i])}this.$component instanceof Component&&this.$component.destroy();this.$listener instanceof Listener&&this.$listener.deattach();this.$pointer&&this.$pointer.parentNode&&this.$pointer.parentNode.removeChild(this.$pointer);this.$pointer=null;this.$redirect=null;this.$component=null;this.render=()=>{};this.html=null;this.$destroyed=!0;return!0};Structure.prototype.render=function(e,t,n,r){n===void 0&&(n=0);r===void 0&&(r=!1);this.$depth=Math.max(this.$depth,n);this.$isSvg=r||t&&t.$isSvg||this.query==='svg';if(this.query==='#text'){this.html=[textNode(this.props)];return e(this.html)}if(typeof this.query==='string'||typeof this.query==='number'){this.html=[getElementFromQuery(this.query,this.$isSvg)];setAttributes(this,this.props,{});return e(this.html)}if(this.query instanceof Listener){this.$listener||(this.$listener=this.query.applyDepth(this.$depth).init(),this.mount());return this.query.onValueChange(n=>{if(this.html){var r=this.html[0];this.$pointer?(this.$redirect=patch(this.$redirect,n,this.$pointer,!0,this.$isSvg,this.$depth+1)):(this.$redirect=patch(this.$redirect,n,r,!0,this.$isSvg,this.$depth+1))}else explode(n,t||this,t=>{this.html=t,e(t)},this.$depth+1,this.$isSvg)})}if(this.query instanceof Promise||this.query.constructor.name==='LazyPromise'){return this.query.then(n=>{var r=n.default||n;explode(r,t||this,t=>{this.html=t,e(t)},this.$depth,this.$isSvg)})}if(this.query instanceof Component&&typeof this.query.render==='function'){this.$component=this.query;return explode(this.$component.render(),t||this,t=>{this.html=t,e(t),this.mount()},this.$depth,this.$isSvg)}if(isComponent(this.query)){this.$component||(this.$component=new this.query(this.$compChildren).setProps(this.props));typeof this.$component.render==='function'&&(explode(this.$component.render(),t||this,t=>{this.html=t,e(t)},this.$depth,this.$isSvg),this.mount());return null}if(typeof this.query==='function'){return explode(this.query(this.props),t||this,t=>{this.html=t,e(t)},this.$depth,this.$isSvg)}return e(textNode(this.query))};var patch=(e,t,n,r,o,i)=>{r===void 0&&(r=!1);o===void 0&&(o=!1);i===void 0&&(i=0);var l=flatten([e]),u=flatten([t]).map(filterNode),s=Math.max(l.length,u.length),a=function(e){if(typeof l[e]==='undefined'){mount(u[e],n,r,o,i);return}if(typeof u[e]==='undefined'){typeof l[e].destroy==='function'&&l[e].destroy();return}u[e].$depth=i;if(l[e] instanceof Structure&&u[e] instanceof Structure&&l[e]!==u[e]){if(l[e].html&&l[e].query==='#text'&&u[e].query==='#text'){for(var t=0;t<l[e].html.length;t++)l[e].props!==u[e].props&&(l[e].html[t].textContent=l[e].props=u[e].props);u[e].html=l[e].html;l[e].html=null;l[e].$pointer&&(u[e].$pointer&&u[e].$pointer.parentNode&&u[e].$pointer.parentNode.removeChild(u[e].$pointer),u[e].$pointer=l[e].$pointer,l[e].$pointer=null);l[e].destroy();return}if(l[e].html&&typeof l[e].query==='string'&&typeof u[e].query==='string'&&l[e].query===u[e].query){u[e].html=l[e].html;l[e].html=null;l[e].$pointer&&(u[e].$pointer&&u[e].$pointer.parentNode&&u[e].$pointer.parentNode.removeChild(u[e].$pointer),u[e].$pointer=l[e].$pointer,l[e].$pointer=null);setAttributes(u[e],u[e].props,l[e].props);u[e].html[0]&&u[e].children&&u[e].children.length>0&&(u[e].children=patch(l[e].children,u[e].children,u[e].html[0],!1,u[e].$isSvg,u[e].$depth+1));l[e].destroy(!1);return}var s=l[e],a=u[e];a.$pointer=textNode('');append(a.$pointer,n,r);a.render(t=>{s.$pointer&&(a.$pointer&&a.$pointer.parentNode&&a.$pointer.parentNode.removeChild(a.$pointer),a.$pointer=s.$pointer,s.$pointer=null);for(var n=0;n<t.length;n++)s.html&&!s.html[e]||!s.html?append(t[n],a.$pointer,!0):append(t[n],s.html[e],!0);mountChildren(a,o,i+1);s.destroy(!1)},a,i,o)}};for(var p=0;p<s;p++)a(p);return u},Component=function(e,t){this.addNonEnumerableProperties({$id:generateId(),$name:this.constructor.name,$config:typeof this.config==='function'?this.config():{listen:!0},$events:{},$privateStore:new PrivateStore});this.on=typeof this.on==='function'?this.on():{};this.children=[];for(var n in GLOBALS.HEADLESS_COMPONENTS)this[n].when('update',()=>this.setState());this.state=typeof this.state==='function'?this.state():(this.state||{});skipInProductionAndTest(()=>Object.freeze(this.state));e&&this.setChildren(e);t&&this.setProps(t)};Component.prototype.render=function(){if(typeof this.view!=='function'){return null}return this.html=this.view()};Component.prototype.setProps=function(e){var t={},n=this,r=function(r){typeof e[r]==='function'&&r.substr(0,2)==='on'?n.when(r.substring(2,r.length),e[r]):e[r] instanceof Listener?(t[r]=e[r].init().value,e[r].changeListener=e=>{n.setState({[r]:e})}):(t[r]=e[r])};for(var o in e)r(o);this.setState(t);return this};Component.prototype.setChildren=function(e){this.children=e;this.setState();for(var t=0;t<this.children.length;t++)typeof this.children[t].when==='function'&&this.children[t].when('update',()=>this.setState());return this};Component.prototype.addNonEnumerableProperties=function(e){for(var t in e){if(typeof this[t]!=='undefined'){continue}Object.defineProperty(this,t,{value:e[t]})}};Component.prototype.addListener=function(e,t,n){this.$privateStore.addListener(e,t,n)};Component.prototype.mount=function(){this.trigger('mount')};Component.prototype.destroy=function(){this.html=null;this.trigger('destroy');this.$privateStore.removeListeners()};Component.prototype.when=function(e,t){typeof this.$events[e]==='undefined'&&(this.$events[e]=[]);this.$events[e].push(t)};Component.prototype.trigger=function(e,...t){typeof this.on[e]==='function'&&this.on[e].call(this,...t);if(typeof this.$events[e]!=='undefined'){for(var n in this.$events[e])this.$events[e][n].call(this,...t)}};Component.prototype.setState=function(e){if(typeof e==='object'){var t=this.state;skipInProductionAndTest(()=>t=clone(this.state));this.state=Object.assign(t,e);skipInProductionAndTest(()=>Object.freeze(this.state));this.$config.listen&&this.$privateStore.setState(e)}!this.$config.listen&&typeof this.view==='function'&&this.html&&(this.html=patch(this.html,this.view()));this.trigger('update');return e};Component.isComponent=function(){return!0};var isComponent=e=>{if(e){if(e.prototype instanceof Component){return!0}if(e.isComponent){return!0}}return!1},filterNode=e=>{if(typeof e==='string'||typeof e==='number'){return r('#text',e)}if(!e||typeof e==='boolean'){return r('#text','')}if(e instanceof Listener){return r(e)}if(isComponent(e)||e instanceof Component){return r(e)}if(typeof e==='function'){return r(e)}if(e instanceof Promise||e.constructor.name==='LazyPromise'){return r(e)}return e},r=(e,t,...n)=>{if(e==='await'){var r=null;t.src&&t.src instanceof Promise&&t.src.then(e=>{var n=filterNode(typeof t.transform==='function'?t.transform(e):e);r?(r=patch(r,n,r.html[0].parentNode)):(r=n)}).catch(e=>{var n=filterNode(typeof t.error==='function'?t.error(e):t.error);r?(r=patch(r,n,r.html[0].parentNode)):(r=n)});r||(r=filterNode(t.placeholder));return r}if(e==='template'){return new Structure('section',t,flatten([n]).map(filterNode))}return new Structure(e,t,flatten([n]).map(filterNode))},listen=(e,...t)=>new Listener(e,...t),remountActiveComponents=()=>{Object.values(GLOBALS.ACTIVE_COMPONENTS).forEach(e=>{typeof e.onMount==='function'&&e.onMount(e)})};function createWorker(e){var t=()=>{},n=new Blob([`self.onmessage = function(e) {
    self.postMessage((${e.toString()})(e.data));
  }`],{type:'text/javascript'}),r=window.URL.createObjectURL(n),o=new Worker(r);o.onmessage=e=>{t(e.data,null)};o.onerror=e=>{t(null,e.data)};return e=>new Promise((n,r)=>{t=(e,t)=>!t?n(e):r(e),o.postMessage(e)})}function worker(e,t,n){var r=n.value,o=createWorker(r);n.value=function(...e){o(...e).then(e=>{this.setState.call(this,e)})};return n}function action(e,t,n){var r=n.value;n.value=function(...e){return this.setState.call(this,r.call(this,...e))};return n}function subscribe(e,t,n){return function(n,r,o){var i='on'+(t||r),l=function(...e){return o.value.call(this,...e)};e[i]=l;return o}}var Radi={version:GLOBALS.VERSION,activeComponents:GLOBALS.ACTIVE_COMPONENTS,r,listen,l:listen,worker,component:Component,Component,action,subscribe,customAttribute:(e,t,n)=>{n===void 0&&(n={});var r=n.allowedTags,o=n.addToElement;GLOBALS.CUSTOM_ATTRIBUTES[e]={name:e,caller:t,allowedTags:r||null,addToElement:o}},headless:(e,t)=>{var n='$'.concat(e),r=new t;r.mount();Component.prototype[n]=r;return GLOBALS.HEADLESS_COMPONENTS[n]=r},update:patch,patch,mount,freeze:()=>{GLOBALS.FROZEN_STATE=!0},unfreeze:()=>{GLOBALS.FROZEN_STATE=!1,remountActiveComponents()}};Radi.plugin=(e,...t)=>e(Radi,...t);window&&(window.Radi=Radi);module.exports=Radi