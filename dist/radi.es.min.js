var GLOBALS={VERSION:'0.5.0',CUSTOM_ATTRIBUTES:{},CUSTOM_TAGS:{},SERVICES:{}};function service(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];if(typeof n!=='string'){throw new Error('[Radi.js] Service first argument has to be string')}if(typeof e!=='function'){throw new Error('[Radi.js] Service second argument has to be function')}var u=e.apply(void 0,t);service.prototype[n]=u;return GLOBALS.SERVICES[n]=u}function customAttribute(n,e,t){t===void 0&&(t={});var r=t.allowedTags,u=t.addToElement;return GLOBALS.CUSTOM_ATTRIBUTES[n]={name:n,caller:e,allowedTags:r||null,addToElement:u}}function customTag(n,e){return GLOBALS.CUSTOM_TAGS[n]={name:n,render:e||(function(){})}}function destroyTree$$1(n){fireEvent('destroy',n);n.__radiRef=void 0;if(n.nodeType===1){var e=n.firstChild;while(e)destroyTree$$1(e),e=e.nextSibling}}function fireEvent(n,e){var t=document.createEvent('Event');t.initEvent(n,!0,!0);typeof e.dispatchEvent==='function'&&(e._eventFired=!0,e.dispatchEvent(t));return e}function capitalise(n){return n.charAt(0).toUpperCase()+n.substr(1)}function flatten(n){return n.reduce(function(n,e){return n.concat(Array.isArray(e)?flatten(e):e)},[])}function ensureArray(n){return flatten([n])}var isValidElement=function(n){return n.name&&(n.value||n.value==='')},isValidValue=function(n){return!['checkbox','radio'].includes(n.type)||n.checked},isCheckbox=function(n){return n.type==='checkbox'},isMultiSelect=function(n){return n.options&&n.multiple},getSelectValues=function(n){return[].reduce.call(n,function(n,e){return e.selected?n.concat(e.value):n},[])},formToJSON=function(n,e){e===void 0&&(e=function(n,e){return e});return[].reduce.call(n,function(n,t){isValidElement(t)&&isValidValue(t)&&(isCheckbox(t)?(n[t.name]=(n[t.name]||[]).concat(e(t,t.value))):isMultiSelect(t)?(n[t.name]=e(t,getSelectValues(t))):(n[t.name]=e(t,t.value)));return n},{})};function html(n,e){var t=[],r=arguments.length-2;while(r-->0)t[r]=arguments[r+2];var u=typeof n==='number'?""+n:n,i=e||{},o=flatten(t);(u instanceof Promise||u&&u.constructor.name==='LazyPromise')&&(u='await',i={src:n});typeof GLOBALS.CUSTOM_TAGS[u]!=='undefined'&&(u=GLOBALS.CUSTOM_TAGS[u].render);return{type:u,props:i,children:o}}function insertAfter(n,e,t){t||(t=e.parentNode);if(n instanceof Node){if(e===null||e===void 0){return t.insertBefore(n,e)}if(e instanceof Node){return t.insertBefore(n,e.nextSibling)}}return n}function mount(n,e,t){var r=ensureArray(n);return ensureArray(r).map(function(n){var u=render$$1(n,e);if(Array.isArray(u)){return mount(u,e,t)}if(t&&t.parentNode){t=insertAfter(u,t,t.parentNode);fireEvent('mount',t);return t}if(!e){console.log('[Radi] Mount canceled',e,t);return r}var i=e.appendChild(u);fireEvent('mount',u);return i})}var Component=function(n){this.type=n;this.name=n.name;this.render=this.render.bind(this);this.evaluate=this.evaluate.bind(this);this.update=this.update.bind(this);this.__$events={}};Component.prototype.on=function(n,e){var t=this.__$events,r="on"+(capitalise(n));t[r]||(t[r]=[]);t[r].push(e);return e};Component.prototype.trigger=function(n){var e,t=[],r=arguments.length-1;while(r-->0)t[r]=arguments[r+1];var u="on"+(capitalise(n));(this.__$events[u]||[]).map(function(n){return n.apply(void 0,t)});typeof this[u]==='function'&&(e=this)[u].apply(e,t)};Component.prototype.evaluate=function(n,e){this.props=n;this.children=e;return this.node=this.type.call(this,Object.assign({},this.props,{children:this.children}))};Component.prototype.render=function(n,e,t){return this.dom=render$$1(this.evaluate(n,e),t)};Component.prototype.update=function(n,e){n===void 0&&(n=this.props);e===void 0&&(e=this.children);var t=this.dom;return this.dom=patch(this.evaluate(n,e),t)};var currentListener=null;function anchored(n,e){return function(t,r){if(n[0]===t){return!1}t!==r&&(n[0]=t,e.dispatch(function(){return t}));return!0}}function extractState(n,e){var t=this;e===void 0&&(e=[]);if(!n){return n}if(this&&n&&typeof n.subscribe==='function'){var r=[];e.length>0?n.subscribe(function(n,u){if(r[0]===n){return!1}n!==u&&(t.dispatch(function(){return t.setPartial(e,n)}),r[0]=n);return!0}):(this.subscribe(anchored(r,n)),n.subscribe(anchored(r,this)));return n.get()}if(n&&typeof n==='object'){var u=Array.isArray(n)?new Array(n.length):{};for(var i in n)n.hasOwnProperty(i)&&(u[i]=extractState.call(t,n[i],e.concat(i)));return u}return n}function clone(n,e){var t=Array.isArray(n)?[]:{};for(var r in n)t[r]=n[r];for(var u in e)t[u]=e[u];return t}var renderQueue=[];function addToRenderQueue(n){var e=n.update||n;renderQueue.indexOf(e)<0&&renderQueue.push(e);return e}function clearRenderQueue(){renderQueue=[]}function Dependencies(){var n=this;this.dependencies={};this.add=function(e,t){var r=e[0];typeof n.dependencies[r]==='undefined'&&(n.dependencies[r]=[]);n.dependencies[r].indexOf(t)<0&&n.dependencies[r].push(t)};this.remove=function(e,t){var r=e[0],u=(n.dependencies[r]||[]).indexOf(t);u>=0&&n.dependencies[r].splice(u,1)};this.fn=function(e){return function(t){var r=currentListener;r&&(n.add(t,r),r.__onDestroy=function(){n.remove(t,r)});return e(t)}};this.trigger=function(e,t,r){n.dependencies[e]&&n.dependencies[e].forEach(function(n){return(addToRenderQueue(n)(t,r))})}}var noop=function(n){return n},Listener=function(n,e,t){this.map=n;this.getValue=this.getValue.bind(this);this.render=this.render.bind(this);this.store=e;this.dep=t};Listener.prototype.getValue=function(n){var e=this.store.get();this.subbed||(this.subbed=this.dep.add('*',n));return this.cached=this.map(e)};Listener.prototype.render=function(){var n=this;return html(function(){var e=n.getValue(this);return e})};function getDataFromObject(n,e){var t=0;while(t<n.length)typeof e==='undefined'?t++:(e=e[n[t++]]);return e}function updateState(n,e,t,r,u,i){i===void 0&&(i='');var o=n.setPartial(t,r);if(!u){var c=function(){return o};Object.defineProperty(c,'name',{value:i,writable:!1});n.dispatch(c)}else n.update(o)}function Store(n){var e=this;n===void 0&&(n={});var t=Object.assign({},n),r=function(n){var e=new Listener(n,r,u);return e},u=new Dependencies,i=noop,o;r.getInitial=function(){return c};r.get=function(n){var e=i(t);if(n){return getDataFromObject(typeof n==='string'?n.split('.'):n,e)}return e};r.setPartial=function(n,r){var u=Array.isArray(t)?[]:{};if(n.length){u[n[0]]=n.length>1?e.setPartial(n.slice(1),r,t[n[0]]):r;return clone(t,u)}return r};r.bind=function(n,e,t){e===void 0&&(e=function(n){return n});t===void 0&&(t=function(n){return n});var u=Array.isArray(n)?n:n.split('.'),i=function(n){return e(getDataFromObject(u,n))},o=function(e){return updateState(r,r.get(),u,t(e),!1,("Bind:"+n))};return{model:r(i),oninput:function(n){return o(n.target.value)}}};r.update=function(n){var e=Object.keys(n||{}),c=Object.assign({},t,n);t=c;var a=r.get();if(i!==noop){for(var d in a)a.hasOwnProperty(d)&&(!o||o&&o[d]!==a[d]&&e.indexOf(d)<0)&&e.push(d)}u.trigger('*',a,o);e.forEach(function(n){return u.trigger(n,a,o)});o=a;clearRenderQueue();return t};r.dispatch=function(n){var e=[],u=arguments.length-1;while(u-->0)e[u]=arguments[u+1];var i=n.apply(void 0,[t].concat(e));return r.update(i)};r.willDispatch=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return function(){var t=[],u=arguments.length;while(u--)t[u]=arguments[u];return r.dispatch.apply(r,[n].concat(e,t))}};r.subscribe=function(n){u.add('*',n);n(r.get(),null);return r};r.unsubscribe=function(n){u.remove('*',n)};r.map=function(n){var e=i;i=function(){var t=[],r=arguments.length;while(r--)t[r]=arguments[r];return n(e.apply(void 0,t))};return r};var c=extractState.call(r,n);return r}function render$$1(n,e){if(Array.isArray(n)){var t=n.map(render$$1);if(t.length===0){return render$$1([null],e)}return t}if(n&&typeof n.type==='function'){var r=new Component(n.type,n.props,n.children),u=r.render(n.props,n.children,e),i;u&&typeof u.addEventListener==='function'&&(u.addEventListener('mount',function(){typeof r.style==='string'&&(i=document.createElement('style'),i.innerHTML=r.style,document.head.appendChild(i));r.trigger('mount',u)},{passive:!0,once:!0},!1),u.addEventListener('destroy',function(){r.trigger('destroy',u);i instanceof Node&&document.head.removeChild(i)},{passive:!0,once:!0},!1));u instanceof Node&&(u.__radiRef=function(n,e){if(e&&Array.isArray(r.dom)){return r.dom[e]=n}return r.dom=n});return u}if(n instanceof Node){return n}if(n instanceof Listener){return n.render()}if(typeof n==='function'){return render$$1(n(),e)}if(['string','number'].indexOf(typeof n)>-1){return document.createTextNode(n)}if(!n){return document.createComment('')}var o;n.type==='svg'||e instanceof SVGElement?(o=document.createElementNS('http://www.w3.org/2000/svg',n.type)):(o=document.createElement(n.type));setProps(o,n.props);n.children&&flatten(n.children||[]).forEach(function(n){var e=n instanceof Node?n:render$$1(n,o);mount(e,o)});return o}function beforeDestroy(n,e){if(typeof n.beforedestroy==='function'){return n.beforedestroy(e)}return e()}function patch(n,e,t,r){t===void 0&&(t=e&&e.parentNode);r===void 0&&(r=null);if(Array.isArray(n)||Array.isArray(e)){var u=Array.isArray(n)&&n.length===0?[null]:ensureArray(n),i=ensureArray(e),o=Array.isArray(e)?e[0]&&e[0].__radiRef:e.__radiRef,c=e,a=u.map(function(n,e){var r=c,u=patch(n,i[e],i[e]&&i[e].parentNode||t,!i[e]&&r);c=Array.isArray(u)?u[0]:u;typeof o==='function'&&e>0&&(c.__radiRef=function(n){return o(n,e)});return u});if(i.length>u.length){var d=i.slice(u.length-i.length);d.forEach(function(n){n&&n.parentNode&&n.parentNode.removeChild(n)})}typeof o==='function'&&o(a);return a}var f=render$$1(n,t);if(!e&&r){var l=mount(f,e,r);return l}e&&t&&(t.insertBefore(f,e),e.__radiRef&&(f.__radiRef=e.__radiRef,f.__radiRef(f)),beforeDestroy(e,function(){t.removeChild(e);destroyTree$$1(e)}));return f}function autoUpdate(n,e){if(n instanceof Listener){return e(n.getValue(function(t){return e(n.map(t))}))}return e(n)}function setBooleanProp(n,e,t){t?(n.setAttribute(e,t),n[e]=!0):(n[e]=!1)}function isEventProp(n){return /^on/.test(n)}function extractEventName(n){return n.slice(2).toLowerCase()}function isCustomProp(n){return isEventProp(n)}function setProp(n,e,t){if(typeof GLOBALS.CUSTOM_ATTRIBUTES[e]!=='undefined'){var r=GLOBALS.CUSTOM_ATTRIBUTES[e],u=r.allowedTags,i=r.addToElement,o=r.caller;if(!u||u&&u.length>0&&u.indexOf(n.localName)>=0){typeof o==='function'&&(t=o(n,t));if(!i){return}}}e==='style'&&typeof t!=='string'?setStyles(n,t):isCustomProp(e)?addEventListener(n,e,t):e==='className'?n.setAttribute('class',t):typeof t==='boolean'?setBooleanProp(n,e,t):(e==='value'&&document.activeElement!==n&&(n[e]=t),n.setAttribute(e,t))}function setStyles(n,e){Object.keys(e).forEach(function(t){autoUpdate(e[t],function(e){n.style[t]=e})})}function setProps(n,e){(Object.keys(e||{})).forEach(function(t){autoUpdate(e[t],function(e){t==='model'?(t='value'):(t==='class'||t==='className')&&(Array.isArray(e)&&(e=e.filter(function(n){return n&&typeof n!=='function'}).join(' ')));setProp(n,t,e)})})}function addEventListener(n,e,t){var r=['mount','destroy'];isEventProp(e)&&n.addEventListener(extractEventName(e),function(u){r.indexOf(e)>=0?(n===u.target&&t(u)):typeof t==='function'&&t(u)},!1)}function Subscribe(n){n===void 0&&(n=document);return{on:function(e,t){t===void 0&&(t=function(n){return n});var r=e.trim().split(' '),u=null,i=null,o=null,c=!1;if(typeof t!=='function'){throw new Error(("[Radi.js] Subscription `"+e+"` must be transformed by function"))}function a(e,a){var d=a||new Store(e||{});c=!0;i=e;o=d;r.forEach(function(e){return n.addEventListener(e,u=function(){var n=[],r=arguments.length;while(r--)n[r]=arguments[r];return d.dispatch(function(r){return(Object.assign({},r,t.apply(void 0,n.concat([e]))))})})});return d}a.stop=function(){c&&r.forEach(function(e){return n.removeEventListener(e,u)});return c=!c};a.start=function(){return!c&&a(i,o)};return a}}}var animate=function(n,e,t,r){var u=t[e];if(typeof u!=='function'){console.warn(("[Radi.js] Animation `"+e+"` for node `"+n.nodeName.toLowerCase+"` should be function"));return}return u(n,r)};customAttribute('animation',function(n,e){animate(n,'in',e,function(){});n.beforedestroy=function(t){return animate(n,'out',e,t)}});customAttribute('html',function(n,e){n.addEventListener('mount',function(){n.escape?(n.textContent=e):(n.innerHTML=e)})});customAttribute('loadfocus',function(n){n.addEventListener('mount',function(){return n.focus()})});customAttribute('onsubmit',function(n,e){return function(t){n.prevent&&t.preventDefault();e(t,formToJSON(n.elements||{}))}},{allowedTags:['form'],addToElement:!0});var errorsStore=new Store({},'errorStore'),setErrors=function(n,e,t){var r;return(Object.assign({},n,(r={}, r[e]=t, r)))};function fullValidate(n,e,t){var r=formToJSON(n,function(n,e){var t=n.touched;return({touched:t,value:e})}),u=Object.keys(r).reduce(function(n,e){var t;return(Object.assign({},n,(t={}, t[e]=r[e].value, t)))},{}),i=[];for(var o in r){var c=r[o];if(typeof e[o]==='function'){var a=e[o](c.value,u),d=a&&typeof a.check==='function'&&a.check()||a||o+' field is invalid';d!==!0&&i.push({field:o,touched:Boolean(c.touched),error:d})}}t(i)}var formCount=0;customAttribute('onvalidate',function(n,e){var t=n.name||'defaultForm'+formCount++,r;function u(n){errorsStore.dispatch(setErrors,t,n)}errorsStore.subscribe(function(n){r&&(r.disabled=n[t].length>0)});n.addEventListener('mount',function(n){var t=e(n),i=n.target.elements;if(t&&typeof t==='object'&&i){for(var o of i){var c=o.name;if(!o.__radiValidate&&typeof c==='string'&&typeof t[c]==='function'){o.addEventListener('input',function(){fullValidate(i,t,u)});o.__radiValidate=!0;o.touched=!1;var a=function(n){var e=n.target;e.touched=!0;e.removeEventListener('change',a);fullValidate(i,t,u)};o.addEventListener('change',a)}o.type==='submit'&&o.disabled===!0&&(r=o)}fullValidate(i,t,u)}},!1)},{allowedTags:['form']});function ensureFn(n){if(typeof n==='function'){return n}return function(e){return n||e}}customTag('await',function(n){var e=this,t,r=n.src,u=n.waitMs,i=n.transform;i===void 0&&(i=function(n){return n});var o=n.error;o===void 0&&(o=function(n){return n});var c=n.placeholder;c===void 0&&(c='Loading..');var a=n.value;a===void 0&&(a=null);var d=n.loaded;d===void 0&&(d=!1);if(!(r&&(r instanceof Promise||r.constructor.name==='LazyPromise'))){console.warn('[Radi] <await/> must have `src` as a Promise');return null}d||(c!==a&&(u?(t=setTimeout(function(){e.update(Object.assign({},n,{value:c}))},u)):(a=c)),r.then(function(r){clearTimeout(t);e.update(Object.assign({},n,{value:ensureFn(i)(r),loaded:!0}))}).catch(function(r){clearTimeout(t);e.update(Object.assign({},n,{value:ensureFn(o)(r),loaded:!0}))}));return a});customTag('errors',function(n){var e=n.name,t=n.onrender;typeof e==='undefined'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `name` attribute!');typeof t!=='function'&&console.warn('[Radi.js] Warn: Every <errors> tag needs to have `onrender` attribute!');return errorsStore(function(n){return n[e]&&t(n[e])})});var h=html,ModalStore=new Store({}),registerModal=function(n,e){var t;return(t={}, t[e]=!1, t)},switchModal=function(n,e,t){var r;return(r={}, r[e]=t, r)},ModalService=service('modal',function(){var n=[],e=arguments.length;while(e--)n[e]=arguments[e];return{open:function(n){return ModalStore.dispatch(switchModal,n,!0)},close:function(n){return ModalStore.dispatch(switchModal,n,!1)},onOpen:function(n,e){return ModalStore.subscribe(function(t,r){return t[n]===!0&&t[n]!==r[n]&&e()})},onClose:function(n,e){return ModalStore.subscribe(function(t,r){return t[n]===!1&&t[n]!==r[n]&&e()})}}});customTag('modal',function(n){var e=n.name;e===void 0&&(e='default');var t=n.children;typeof e==='undefined'&&console.warn('[Radi.js] Warn: Every <modal> tag needs to have `name` attribute!');this.onMount=function(n){return ModalStore.dispatch(registerModal,e)};return h('portal',{},ModalStore(function(n){return n[e]&&h('div',{class:'radi-modal',name:e},h('div',{class:'radi-modal-backdrop',onclick:function(){return service.modal.close(e)}}),h.apply(void 0,['div',{class:'radi-modal-content'}].concat((t.slice()))))}))});customTag('portal',function(n){var e,t,r=n.children||[];this.onMount=function(u){mount(function(){this.onMount=function(n,r){e=n;t=r};return function(){return r}},n.on||document.body)};this.onDestroy=function(n,u){patch(t,null,r,0,e||n)};return null});var validValue=function(n){return typeof n==='string'||typeof n==='number'||n},Validator=function(n){this.value=n;this.rules=[]};Validator.prototype.register=function(n){var e=this,t=n.type,r=n.validate,u=n.error,i=this.rules.push({type:t,validate:function(n){return validValue(n)&&r(n)},error:u||'Invalid field'});this.error=function(n){e.rules[i-1].error=n||u;return e};return this};Validator.prototype.check=function(n){var e=this;typeof n!=='undefined'&&(this.value=n);return this.rules.reduce(function(n,t){return typeof n==='string'?n:!t.validate(e.value)&&t.error||n},!0)};Validator.prototype.required=function(){return this.register({type:'required',validate:function(n){return n!==''},error:'Field is required'})};Validator.prototype.test=function(n){return this.register({type:'test',validate:function(e){return e===''||n.test(e)},error:'Field must be valid'})};Validator.prototype.equal=function(n){return this.register({type:'equal',validate:function(e){return e===''||e===n},error:'Field must be equal to '+n})};Validator.prototype.notEqual=function(n){return this.register({type:'notEqual',validate:function(e){return e===''||e!==n},error:'Field must not be equal to '+n})};Validator.prototype.min=function(n){return this.register({type:'min',validate:function(e){return e.length>=n},error:'Min char length is '+n})};Validator.prototype.max=function(n){return this.register({type:'max',validate:function(e){return e.length<n},error:'Max char length is '+n})};Validator.prototype.email=function(){return this.register({type:'email',validate:function(n){return n===''||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)},error:'Email is not valid'})};var Radi={v:GLOBALS.VERSION,version:GLOBALS.VERSION,h:html,html:html,Store:Store,customTag:customTag,customAttribute:customAttribute,patch:patch,mount:mount,service:service,Subscribe:Subscribe,Validator:Validator};Radi.plugin=function(n){var e=[],t=arguments.length-1;while(t-->0)e[t]=arguments[t+1];return n.apply(void 0,[Radi].concat(e))};window&&(window.Radi=Radi);export default Radi